===== Dockerfile =====
# Use official Python image as base
FROM python:3.10.4-slim-bullseye

# Install system dependencies for WeasyPrint
RUN apt-get update && apt-get install -y \
    build-essential \
    libpango-1.0-0 \
    libpangocairo-1.0-0 \
    libcairo2 \
    libgdk-pixbuf2.0-0 \
    libffi-dev \
    shared-mime-info \
    fonts-liberation \
    fonts-dejavu \
    curl \
    wget \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Set environment variables
ENV PIP_DISABLE_PIP_VERSION_CHECK=1
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Set work directory
WORKDIR /code

# Install Python dependencies
COPY ./requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy project files
COPY . .

# Run Gunicorn
CMD ["sh", "-c", "gunicorn django_project.wsgi --bind 0.0.0.0:${PORT:-8000}"]
===== docker-compose.yml =====
services:
  web:
    build: .
    command: python manage.py runserver 0.0.0.0:8080  # Run Django on port 8080
    ports:
      - "8080:8080"  # Maps container port 8080 to localhost:8080
    depends_on:
      db:
        condition: service_healthy  # Ensures DB is ready before Django starts
    environment:
      - "DJANGO_DEBUG=True"
      - "DJANGO_SECURE_SSL_REDIRECT=False"
      - "DJANGO_SECURE_HSTS_SECONDS=0"
      - "DJANGO_SECURE_HSTS_INCLUDE_SUBDOMAINS=False"
      - "DJANGO_SECURE_HSTS_PRELOAD=False"
      - "DJANGO_SESSION_COOKIE_SECURE=False"
      - "DJANGO_CSRF_COOKIE_SECURE=False"
      - "DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}"
    volumes:
      - .:/code    # Mounts your project directory into the container
    networks:
      - art_moving_network

  db:
    image: postgres:15  # Upgraded to latest stable version
    container_name: art_moving_db
    restart: always
    volumes:
      - postgres_data:/var/lib/postgresql/data/
    environment:
      POSTGRES_DB: art_moving
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres  # ✅ Secure authentication
    healthcheck:  # Ensures DB is ready before Django starts
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 5s
      retries: 5
    networks:
      - art_moving_network

volumes:
  postgres_data:

networks:
  art_moving_network:
===== docker-compose-prod.yml =====
services:
  web:
    build: .
    command: gunicorn django_project.wsgi --bind 0.0.0.0:$PORT
    ports:
      - "8000:8000"
    depends_on:
      db:
        condition: service_healthy
    environment:
      - "DJANGO_DEBUG=False"
      - "DJANGO_SECURE_SSL_REDIRECT=True"
      - "DJANGO_SECURE_HSTS_SECONDS=2592000"  # 30 days
      - "DJANGO_SECURE_HSTS_INCLUDE_SUBDOMAINS=True"
      - "DJANGO_SECURE_HSTS_PRELOAD=True"
      - "DJANGO_SESSION_COOKIE_SECURE=True"
      - "DJANGO_CSRF_COOKIE_SECURE=True"
      - "PORT=8000"  # Needed for Heroku
      - "DATABASE_URL=${DATABASE_URL}"
  db:
    image: postgres:15
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      - POSTGRES_HOST_AUTH_METHOD=trust
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      retries: 5
      timeout: 5s

volumes:
  postgres_data:
===== heroku.yml =====
build:
  docker:
    web: Dockerfile  # Tells Heroku to use the Dockerfile to build your app

release:
  image: web
  command:
    - python manage.py migrate  # Runs database migrations
    - python manage.py collectstatic --noinput  # Collects static files

run:
  web: gunicorn django_project.wsgi --bind 0.0.0.0:$PORT  # Starts the app
===== requirements.txt =====
asgiref==3.8.1
crispy-bootstrap5==2025.4
diff-match-patch==20241021
Django==5.1.6
django-crispy-forms==2.4
django-environ==0.12.0
django-import-export==4.3.7
gunicorn==23.0.0
numpy==2.2.5
packaging==25.0
pandas==2.2.3
psycopg2-binary==2.9.10
python-dateutil==2.9.0.post0
pytz==2025.2
six==1.17.0
sqlparse==0.5.3
tablib==3.8.0
typing_extensions==4.13.2
tzdata==2025.2
whitenoise==6.9.0
weasyprint==60.2
pydyf==0.8.0


===== manage.py =====
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()


===== accounts/models.py =====
from django.contrib.auth.models import AbstractUser
from django.db import models


class CustomUser(AbstractUser):
    pass

===== accounts/views.py =====
from django.urls import reverse_lazy
from django.views import generic
from django.contrib.auth import logout
from django.shortcuts import redirect, render
from .forms import CustomUserCreationForm
from django.contrib.auth import login

def custom_logout(request):
    """Logs out the user and redirects to the homepage."""
    print("🚀 custom_logout was called!")
    request.session.flush()  # Clears session data manually
    logout(request)
    return redirect("/")  # Redirect to the root URL explicitly

class SignupPageView(generic.CreateView):
    """Handles user sign-up using Django’s built-in authentication system."""
    form_class = CustomUserCreationForm
    success_url = reverse_lazy("login")  # Redirect to login page after sign-up
    template_name = "registration/signup.html"


===== accounts/forms.py =====
from django.contrib.auth import get_user_model
from django.contrib.auth.forms import UserCreationForm, UserChangeForm


class CustomUserCreationForm(UserCreationForm):
    class Meta:
        model = get_user_model()
        fields = (
            "email",
            "username",
        )


class CustomUserChangeForm(UserChangeForm):
    class Meta:
        model = get_user_model()
        fields = (
            "email",
            "username",
        )

===== accounts/urls.py =====
from django.urls import path
from .views import SignupPageView, custom_logout

urlpatterns = [
    path("signup/", SignupPageView.as_view(), name="signup"),
    path("logout/", custom_logout, name="logout"),
]


===== accounts/admin.py =====
from django.contrib import admin
from django.contrib.auth import get_user_model
from django.contrib.auth.admin import UserAdmin

from .forms import CustomUserCreationForm, CustomUserChangeForm

CustomUser = get_user_model()

@admin.register(CustomUser)
class CustomUserAdmin(UserAdmin):
    model = CustomUser
    add_form = CustomUserCreationForm
    form = CustomUserChangeForm

    list_display = ("email", "username", "is_superuser")
    list_filter  = ("is_superuser", "is_staff", "is_active")

    search_fields = ("email", "username")
    ordering      = ("email",)

    # Edit form layout
    fieldsets = (
        (None,               {"fields": ("email", "username", "password")}),
        ("Permissions",      {"fields": ("is_active", "is_staff", "is_superuser",
                                         "groups", "user_permissions")}),
        ("Important dates",  {"fields": ("last_login", "date_joined")}),
    )

    # Add form layout (uses Django's built‑in password1/password2 fields)
    add_fieldsets = (
        (None, {
            "classes": ("wide",),
            "fields": ("email", "username", "password1", "password2",
                       "is_active", "is_staff"),
        }),
    )


===== pages/models.py =====
from django.db import models

# Create your models here.


===== pages/views.py =====
from django.contrib.auth.mixins import LoginRequiredMixin
from django.views.generic import TemplateView

class HomePageView(LoginRequiredMixin, TemplateView):
    template_name = 'home.html'


===== pages/urls.py =====
from django.urls import path
from .views import HomePageView

urlpatterns = [
    path("", HomePageView.as_view(), name="home"),  # Ensure this exists!
]


===== pages/admin.py =====
from django.contrib import admin

# Register your models here.


===== workorders/models.py =====
from django.db import models
from django.conf import settings

class WorkOrder(models.Model):
    STATUS_CHOICES = [
        ('pending', 'Pending'),
        ('in_progress', 'In Progress'),
        ('completed', 'Completed'),
    ]

    client = models.ForeignKey(
        'clients.Client',
        on_delete=models.CASCADE,
        related_name='work_orders'
    )
    job_description = models.TextField(blank=True, null=True)
    estimated_cost = models.DecimalField(
        max_digits=10,
        decimal_places=2,
        blank=True,
        null=True
    )
    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='pending')
    completed_at = models.DateTimeField(blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    # ✅ New fields
    invoiced = models.BooleanField(default=False)

    def __str__(self):
        return f"WorkOrder #{self.id} for {self.client.name}"

    def update_status(self):
        if self.status == 'completed':
            return
        if self.events.filter(date__isnull=False).exists():
            self.status = 'in_progress'
        else:
            self.status = 'pending'


class Event(models.Model):
    EVENT_TYPES = [
        ('pickup', 'Pickup'),
        ('pickup_wrap', 'Pickup and Wrap'),
        ('wrap', 'Wrap'),
        ('install', 'Install'),
        ('deliver_install', 'Deliver and Install'),
        ('dropoff', 'Drop Off'),
    ]
    work_order = models.ForeignKey(WorkOrder, on_delete=models.CASCADE, related_name='events')
    event_type = models.CharField(max_length=30, choices=EVENT_TYPES)
    address = models.CharField(max_length=255, blank=True)
    date = models.DateField(blank=True, null=True)

    def __str__(self):
        return f"{self.get_event_type_display()} for WorkOrder #{self.work_order.id}"


class JobAttachment(models.Model):
    work_order = models.ForeignKey(WorkOrder, on_delete=models.CASCADE, related_name='attachments')
    file = models.FileField(upload_to='job_attachments/')
    uploaded_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"Attachment {self.id} for WorkOrder {self.work_order.id}"


class JobNote(models.Model):
    work_order = models.ForeignKey(WorkOrder, on_delete=models.CASCADE, related_name='notes')
    note = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"Note {self.id} for WorkOrder {self.work_order.id}"


===== workorders/views.py =====
from django.shortcuts import render, redirect, get_object_or_404
from django.utils import timezone
from django.http import HttpResponseRedirect, JsonResponse, HttpResponse
from django.urls import reverse
from django.contrib.auth.decorators import login_required
from django.contrib import messages
from django.db.models import Q

from .models import WorkOrder, Event, JobAttachment, JobNote
from .forms import WorkOrderForm, EventFormSet, JobAttachmentForm, JobNoteForm

# workorders/views.py
from django.template.loader import render_to_string
from weasyprint import HTML

def workorder_pdf(request, pk):
    workorder = get_object_or_404(WorkOrder, pk=pk)
    html_string = render_to_string("workorders/workorder_pdf.html", {
        "job": workorder,
        "events": workorder.events.all().order_by('date'),
        "notes": workorder.notes.all().order_by('-created_at'),
        "attachments": workorder.attachments.exclude(file__exact=''),
    })
    html = HTML(string=html_string, base_url=request.build_absolute_uri())
    pdf = html.write_pdf()

    response = HttpResponse(pdf, content_type="application/pdf")
    # Changed from attachment to inline so it opens in browser for printing
    response["Content-Disposition"] = f"inline; filename=WorkOrder_{workorder.id}.pdf"
    return response


@login_required
def workorder_calendar_data(request):
    """Returns only pending and scheduled events for calendar display, excluding completed jobs."""
    events = []

    # A simple palette to pick a distinct color per work order:
    palette = [
        "#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd",
        "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"
    ]
    def get_color(wo_id):
        return palette[wo_id % len(palette)]

    # Only scheduled Event objects for pending and in-progress jobs (no completed jobs)
    scheduled_events = Event.objects.filter(
        date__isnull=False,
        work_order__status__in=["pending", "in_progress"]
    )
    for evt in scheduled_events:
        events.append({
            "title": f"{evt.get_event_type_display()}: {evt.work_order.client.name}",
            "start": evt.date.isoformat(),
            "color": get_color(evt.work_order.id),
            "url": f"/workorders/detail/{evt.work_order.id}/",
        })

    return JsonResponse(events, safe=False)


@login_required
def workorder_list(request):
    query = request.GET.get('q', '')

    pending_jobs = WorkOrder.objects.exclude(events__date__isnull=False)\
                                    .filter(status__in=["pending", "in_progress"])
    scheduled_jobs = WorkOrder.objects.filter(
        events__date__isnull=False,
        status__in=["pending", "in_progress"]
    ).distinct()

    completed_invoiced_jobs = WorkOrder.objects.filter(status='completed', invoiced=True)
    completed_uninvoiced_jobs = WorkOrder.objects.filter(status='completed', invoiced=False)

    if query:
        pending_jobs = pending_jobs.filter(client__name__icontains=query)
        scheduled_jobs = scheduled_jobs.filter(client__name__icontains=query)
        completed_invoiced_jobs = completed_invoiced_jobs.filter(client__name__icontains=query)
        completed_uninvoiced_jobs = completed_uninvoiced_jobs.filter(client__name__icontains=query)

    context = {
        'query': query,
        'pending_jobs': pending_jobs.order_by('-updated_at')[:5],
        'scheduled_jobs': scheduled_jobs.order_by('-updated_at')[:5],
        'completed_invoiced_jobs': completed_invoiced_jobs.order_by('-completed_at')[:5],
        'completed_uninvoiced_jobs': completed_uninvoiced_jobs.order_by('-completed_at')[:5],
    }
    return render(request, 'workorders/workorder_list.html', context)


@login_required
def workorder_create(request):
    if request.method == 'POST':
        form = WorkOrderForm(request.POST)
        event_formset = EventFormSet(request.POST, prefix="events")
        attachment_form = JobAttachmentForm(request.POST, request.FILES)
        note_form = JobNoteForm(request.POST)

        if form.is_valid() and event_formset.is_valid():
            workorder = form.save()
            event_formset.instance = workorder
            event_formset.save()

            workorder.update_status()
            workorder.save()

            if attachment_form.is_valid():
                uploaded = request.FILES.get('file')
                if uploaded:
                    attachment = attachment_form.save(commit=False)
                    attachment.work_order = workorder
                    attachment.save()

            if note_form.is_valid():
                text = note_form.cleaned_data.get('note', '').strip()
                if text:
                    note = note_form.save(commit=False)
                    note.work_order = workorder
                    note.save()

            # Handle different submit buttons
            if 'save_and_invoice' in request.POST:
                messages.success(request, f"Work order #{workorder.id} created successfully.")
                return redirect(f'/invoices/create/?work_order={workorder.id}')
            elif 'save_and_complete' in request.POST:
                workorder.status = 'completed'
                workorder.completed_at = timezone.now()
                workorder.save()
                messages.success(request, f"Work order #{workorder.id} created and marked as completed.")
                return redirect("workorder_detail", job_id=workorder.id)
            else:  # save_only
                messages.success(request, f"Work order #{workorder.id} created successfully.")
                return redirect("workorder_detail", job_id=workorder.id)
    else:
        form = WorkOrderForm()
        event_formset = EventFormSet(prefix="events")
        attachment_form = JobAttachmentForm()
        note_form = JobNoteForm()

    return render(request, 'workorders/workorder_form.html', {
        'form': form,
        'event_formset': event_formset,
        'attachment_form': attachment_form,
        'note_form': note_form,
    })


@login_required
def workorder_edit(request, job_id):
    workorder = get_object_or_404(WorkOrder, id=job_id)
    if request.method == 'POST':
        form = WorkOrderForm(request.POST, instance=workorder)
        event_formset = EventFormSet(request.POST, instance=workorder, prefix="events")
        attachment_form = JobAttachmentForm(request.POST, request.FILES)
        note_form = JobNoteForm(request.POST)

        if form.is_valid() and event_formset.is_valid():
            form.save()
            event_formset.save()

            workorder.update_status()
            workorder.save()

            if attachment_form.is_valid():
                uploaded = request.FILES.get('file')
                if uploaded:
                    attachment = attachment_form.save(commit=False)
                    attachment.work_order = workorder
                    attachment.save()

            if note_form.is_valid():
                text = note_form.cleaned_data.get('note', '').strip()
                if text:
                    note = note_form.save(commit=False)
                    note.work_order = workorder
                    note.save()

            # Handle different submit buttons
            if 'save_and_invoice' in request.POST:
                messages.success(request, f"Work order #{workorder.id} updated successfully.")
                return redirect(f'/invoices/create/?work_order={workorder.id}')
            elif 'save_and_complete' in request.POST:
                workorder.status = 'completed'
                workorder.completed_at = timezone.now()
                workorder.save()
                messages.success(request, f"Work order #{workorder.id} updated and marked as completed.")
                return redirect("workorder_detail", job_id=workorder.id)
            else:  # save_only
                messages.success(request, f"Work order #{workorder.id} updated successfully.")
                return redirect("workorder_detail", job_id=workorder.id)
    else:
        form = WorkOrderForm(instance=workorder)
        event_formset = EventFormSet(instance=workorder, prefix="events")
        attachment_form = JobAttachmentForm()
        note_form = JobNoteForm()

    return render(request, "workorders/workorder_form.html", {
        'form': form,
        'event_formset': event_formset,
        'attachment_form': attachment_form,
        'note_form': note_form,
        'job': workorder,
    })


@login_required
def workorder_delete(request, job_id):
    workorder = get_object_or_404(WorkOrder, id=job_id)
    if request.method == 'POST':
        workorder.delete()
        messages.success(request, "Work order deleted successfully.")
        return redirect('workorder_list')
    return render(request, 'workorders/workorder_confirm_delete.html', {'workorder': workorder})


@login_required
def mark_scheduled(request, job_id):
    return redirect('workorder_edit', job_id=job_id)


@login_required
def mark_completed(request, job_id):
    workorder = get_object_or_404(WorkOrder, id=job_id)
    if workorder.status in ['pending', 'in_progress']:
        workorder.status = 'completed'
        workorder.completed_at = timezone.now()
        workorder.save()
        messages.success(request, "Work order marked as completed.")
    return HttpResponseRedirect(request.META.get('HTTP_REFERER', reverse('workorder_list')))


@login_required
def complete_and_invoice(request, job_id):
    """Mark work order as completed and redirect to invoice creation"""
    workorder = get_object_or_404(WorkOrder, id=job_id)
    if workorder.status in ['pending', 'in_progress']:
        workorder.status = 'completed'
        workorder.completed_at = timezone.now()
        workorder.save()
        messages.success(request, f"Work order #{job_id} marked as completed.")
    
    return redirect(f'/invoices/create/?work_order={workorder.id}')


@login_required
def mark_paid(request, job_id):
    workorder = get_object_or_404(WorkOrder, id=job_id)

    if workorder.status == 'completed' and not workorder.invoiced:
        workorder.invoiced = True
        workorder.save()
        messages.success(request, f"Work order #{job_id} marked as paid.")

    return HttpResponseRedirect(request.META.get('HTTP_REFERER', reverse('completed_jobs')))


@login_required
def mark_completed_and_paid(request, job_id):
    """Mark work order as completed and paid in one action"""
    workorder = get_object_or_404(WorkOrder, id=job_id)
    
    if workorder.status in ['pending', 'in_progress']:
        workorder.status = 'completed'
        workorder.completed_at = timezone.now()
    
    workorder.invoiced = True
    workorder.save()
    messages.success(request, f"Work order #{job_id} marked as completed and paid.")
    
    return HttpResponseRedirect(request.META.get('HTTP_REFERER', reverse('workorder_list')))


@login_required
def workorder_detail(request, job_id):
    workorder = get_object_or_404(WorkOrder, id=job_id)
    events = workorder.events.all()
    attachments = workorder.attachments.exclude(file__exact='')
    notes = workorder.notes.all()

    attachment_form = JobAttachmentForm()
    note_form = JobNoteForm()

    if request.method == 'POST':
        if 'attachment_submit' in request.POST:
            attachment_form = JobAttachmentForm(request.POST, request.FILES)
            uploaded = request.FILES.get('file')
            if attachment_form.is_valid() and uploaded:
                attachment = attachment_form.save(commit=False)
                attachment.work_order = workorder
                attachment.save()
            return redirect('workorder_detail', job_id=workorder.id)

        elif 'note_submit' in request.POST:
            note_form = JobNoteForm(request.POST)
            if note_form.is_valid():
                text = note_form.cleaned_data.get('note', '').strip()
                if text:
                    note = note_form.save(commit=False)
                    note.work_order = workorder
                    note.save()
            return redirect('workorder_detail', job_id=workorder.id)

    return render(request, 'workorders/workorder_detail.html', {
        'job': workorder,
        'events': events,
        'attachments': attachments,
        'notes': notes,
        'attachment_form': attachment_form,
        'note_form': note_form,
    })


@login_required
def pending_jobs_view(request):
    query = request.GET.get('q', '')
    jobs = WorkOrder.objects.exclude(events__date__isnull=False)\
                            .filter(status__in=["pending", "in_progress"])\
                            .order_by('-updated_at')
    if query:
        jobs = jobs.filter(client__name__icontains=query)
    return render(request, 'workorders/pending_jobs.html', {'jobs': jobs, 'query': query})


@login_required
def scheduled_jobs_view(request):
    query = request.GET.get('q', '')
    jobs = WorkOrder.objects.filter(events__date__isnull=False,
                                    status__in=["pending", "in_progress"])\
                            .distinct()\
                            .order_by('-updated_at')
    if query:
        jobs = jobs.filter(client__name__icontains=query)
    return render(request, 'workorders/scheduled_jobs.html', {'jobs': jobs, 'query': query})


@login_required
def completed_jobs_view(request):
    query = request.GET.get('q', '')

    uninvoiced_jobs = WorkOrder.objects.filter(status='completed', invoiced=False).order_by('-completed_at')
    invoiced_jobs = WorkOrder.objects.filter(status='completed', invoiced=True).order_by('-completed_at')

    if query:
        uninvoiced_jobs = uninvoiced_jobs.filter(client__name__icontains=query)
        invoiced_jobs = invoiced_jobs.filter(client__name__icontains=query)

    context = {
        'query': query,
        'uninvoiced_jobs': uninvoiced_jobs,
        'invoiced_jobs': invoiced_jobs,
    }
    return render(request, 'workorders/completed_jobs.html', context)

===== workorders/forms.py =====
from django import forms
from django.forms import inlineformset_factory
from django.apps import apps
from .models import WorkOrder, Event, JobAttachment, JobNote

class WorkOrderForm(forms.ModelForm):
    client = forms.ModelChoiceField(
        queryset=None,
        widget=forms.Select(attrs={
            'class': 'form-control select2',
            'data-placeholder': 'Search or select a client'
        }),
        label="Client"
    )

    class Meta:
        model = WorkOrder
        fields = [
            'client',
            'job_description',
            'estimated_cost',
        ]

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        Client = apps.get_model('clients', 'Client')
        self.fields['client'].queryset = Client.objects.all()

        self.fields['job_description'].required = False
        self.fields['estimated_cost'].required = False
        self.fields['estimated_cost'].widget.attrs.update({
            'class': 'form-control',
            'placeholder': '0.00'
        })

class EventForm(forms.ModelForm):
    date = forms.DateField(
        required=False,
        widget=forms.DateInput(attrs={
            'class': 'form-control datepicker',
            'placeholder': 'YYYY-MM-DD'
        })
    )
    event_type = forms.ChoiceField(
        required=False,
        choices=[('', '---------')] + Event.EVENT_TYPES,
        widget=forms.Select(attrs={'class': 'form-control'}),
        label="Event Type"
    )
    address = forms.CharField(
        required=False,
        widget=forms.TextInput(attrs={'class': 'form-control'}),
        label="Address"
    )

    class Meta:
        model = Event
        fields = ['event_type', 'address', 'date']

EventFormSet = inlineformset_factory(
    WorkOrder,
    Event,
    form=EventForm,
    extra=1,
    can_delete=True
)

class JobAttachmentForm(forms.ModelForm):
    file = forms.FileField(required=False)

    class Meta:
        model = JobAttachment
        fields = ['file']

class JobNoteForm(forms.ModelForm):
    note = forms.CharField(required=False, widget=forms.Textarea, label="Note")

    class Meta:
        model = JobNote
        fields = ['note']

===== workorders/urls.py =====
from django.urls import path
from . import views

urlpatterns = [
    path('', views.workorder_list, name='workorder_list'),
    path('create/', views.workorder_create, name='workorder_create'),
    path('edit/<int:job_id>/', views.workorder_edit, name='workorder_edit'),
    path('delete/<int:job_id>/', views.workorder_delete, name='workorder_delete'),

    path('pending/', views.pending_jobs_view, name='pending_jobs'),
    path('scheduled/', views.scheduled_jobs_view, name='scheduled_jobs'),
    path('completed/', views.completed_jobs_view, name='completed_jobs'),

    path('mark_completed/<int:job_id>/', views.mark_completed, name='mark_completed'),
    path('complete_and_invoice/<int:job_id>/', views.complete_and_invoice, name='complete_and_invoice'),
    path('mark_completed_and_paid/<int:job_id>/', views.mark_completed_and_paid, name='mark_completed_and_paid'),

    path('detail/<int:job_id>/', views.workorder_detail, name='workorder_detail'),
    path('mark_paid/<int:job_id>/', views.mark_paid, name='mark_paid'),


    # Calendar JSON API
    path("calendar-data/workorders/", views.workorder_calendar_data, name="workorder_calendar_data"),

    path("<int:pk>/pdf/", views.workorder_pdf, name="workorder_pdf"),

]

===== workorders/admin.py =====
from django.contrib import admin
from import_export.admin import ImportExportModelAdmin
from .models import WorkOrder, Event, JobAttachment, JobNote
from .resources import WorkOrderResource, EventResource  # ✅ make sure both exist

# --------------------------
# ✅ Inline for Events (for editing inside WorkOrder)
# --------------------------
class EventInline(admin.TabularInline):
    model = Event
    extra = 1

# --------------------------
# ✅ WorkOrder Admin
# --------------------------
@admin.register(WorkOrder)
class WorkOrderAdmin(ImportExportModelAdmin):
    resource_class = WorkOrderResource
    inlines = [EventInline]
    list_display = ['id', 'client', 'job_description', 'status', 'invoiced', 'created_at', 'updated_at']
    search_fields = ['client__name', 'job_description']
    list_filter = ['status', 'invoiced', 'created_at', 'updated_at']

# --------------------------
# ✅ Event Admin (standalone import/export)
# --------------------------
@admin.register(Event)
class EventAdmin(ImportExportModelAdmin):
    resource_class = EventResource
    list_display = ['id', 'event_type', 'address', 'date', 'work_order']
    search_fields = ['event_type', 'address', 'work_order__job_description']
    list_filter = ['event_type', 'date']

# --------------------------
# ✅ Optional: JobAttachment/JobNote (basic admin)
# --------------------------
@admin.register(JobAttachment)
class JobAttachmentAdmin(admin.ModelAdmin):
    list_display = ['id', 'work_order', 'file', 'uploaded_at']
    readonly_fields = ['uploaded_at']

@admin.register(JobNote)
class JobNoteAdmin(admin.ModelAdmin):
    list_display = ['id', 'work_order', 'note', 'created_at']
    readonly_fields = ['created_at']


===== clients/models.py =====
from django.db import models

class Client(models.Model):
    name = models.CharField(max_length=255)
    email = models.EmailField(blank=True, null=True)
    phone = models.CharField(max_length=50, blank=True, null=True)
    address = models.CharField(max_length=255, blank=True, null=True)
    billing_address = models.CharField(max_length=255, blank=True, null=True)  # ✅ NEW FIELD

    def __str__(self):
        return self.name

===== clients/views.py =====
from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.decorators import login_required
from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt
from .models import Client
from .forms import ClientForm

@login_required
def client_list(request):
    query = request.GET.get('q', '')
    clients = Client.objects.all()
    if query:
        clients = clients.filter(name__icontains=query)
    context = {'clients': clients, 'query': query}
    return render(request, 'clients/client_list.html', context)

@login_required
def client_detail(request, client_id):
    client = get_object_or_404(Client, id=client_id)
    # Work orders will be available through the reverse relationship: client.work_orders.all()
    context = {'client': client}
    return render(request, 'clients/client_detail.html', context)

@login_required
def client_create(request):
    if request.method == 'POST':
        form = ClientForm(request.POST)
        if form.is_valid():
            form.save()
            return redirect('client_list')
    else:
        form = ClientForm()
    context = {'form': form}
    return render(request, 'clients/client_form.html', context)

@login_required
def client_create_ajax(request):
    """AJAX endpoint for creating clients from work order form"""
    if request.method == 'POST':
        try:
            # Create client from POST data
            client = Client(
                name=request.POST.get('name', '').strip(),
                email=request.POST.get('email', '').strip() or None,
                phone=request.POST.get('phone', '').strip() or None,
                address=request.POST.get('address', '').strip() or None,
                billing_address=request.POST.get('billing_address', '').strip() or None,
            )
            
            # Validate required fields
            if not client.name:
                return JsonResponse({'success': False, 'error': 'Name is required'})
            
            client.save()
            
            return JsonResponse({
                'success': True,
                'client': {
                    'id': client.id,
                    'name': client.name,
                    'email': client.email,
                    'phone': client.phone,
                    'address': client.address,
                    'billing_address': client.billing_address,
                }
            })
            
        except Exception as e:
            return JsonResponse({'success': False, 'error': str(e)})
    
    return JsonResponse({'success': False, 'error': 'Invalid request method'})

@login_required
def client_edit(request, client_id):
    client = get_object_or_404(Client, id=client_id)
    if request.method == 'POST':
        form = ClientForm(request.POST, instance=client)
        if form.is_valid():
            form.save()
            return redirect('client_detail', client_id=client.id)
    else:
        form = ClientForm(instance=client)
    context = {'form': form, 'client': client}
    return render(request, 'clients/client_form.html', context)

===== clients/forms.py =====
from django import forms
from .models import Client

class ClientForm(forms.ModelForm):
    class Meta:
        model = Client
        fields = ['name', 'email', 'phone', 'address', 'billing_address']
        widgets = {
            'name': forms.TextInput(attrs={'class': 'form-control'}),
            'email': forms.EmailInput(attrs={'class': 'form-control'}),
            'phone': forms.TextInput(attrs={'class': 'form-control'}),
            'address': forms.TextInput(attrs={'class': 'form-control'}),
            'billing_address': forms.TextInput(attrs={'class': 'form-control'}),
        }
        labels = {
            'name': 'Name',
            'email': 'Email',
            'phone': 'Phone',
            'address': 'Service Address',
            'billing_address': 'Billing Address',
        }
        help_texts = {
            'name': None,
            'email': None, 
            'phone': None,
            'address': None,
            'billing_address': None,  # No help text - completely independent
        }

===== clients/urls.py =====
from django.urls import path
from . import views

urlpatterns = [
    path('', views.client_list, name='client_list'),
    path('create/', views.client_create, name='client_create'),
    path('create-ajax/', views.client_create_ajax, name='client_create_ajax'),
    path('<int:client_id>/', views.client_detail, name='client_detail'),
    path('edit/<int:client_id>/', views.client_edit, name='client_edit'),
]

===== clients/admin.py =====
from django.contrib import admin
from .models import Client

from import_export.admin import ImportExportModelAdmin
from .resources import ClientResource

@admin.register(Client)
class ClientAdmin(ImportExportModelAdmin):
    resource_class = ClientResource
    list_display = ('id', 'name', 'email', 'phone', 'address')





===== invoices/models.py =====
import random
from django.db import models
from django.utils import timezone

class Invoice(models.Model):
    STATUS_CHOICES = [
        ('unpaid', 'Not in QuickBooks'),
        ('in_quickbooks', 'In QuickBooks'),
        ('paid', 'Paid'),
    ]

    
    invoice_number = models.CharField(max_length=50, unique=True, blank=True)
    client = models.ForeignKey('clients.Client', on_delete=models.CASCADE, related_name='invoices')
    # Optional: link to a work order
    work_order = models.ForeignKey(
        'workorders.WorkOrder',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='invoices'
    )
    date_created = models.DateField(default=timezone.now)
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='unpaid')
    notes = models.TextField(blank=True, null=True)

    def save(self, *args, **kwargs):
        if not self.invoice_number:
            self.invoice_number = ""  # Set empty first
        super().save(*args, **kwargs)
        if not self.invoice_number:  # After save, we have an ID
            self.invoice_number = str(self.id)
            super().save(update_fields=['invoice_number'])

    def __str__(self):
        return f"Invoice {self.invoice_number} - {self.client.name}"

===== invoices/views.py =====
from django.shortcuts import render, redirect, get_object_or_404
from django.http import JsonResponse, HttpResponse
from django.db.models import Q
from django.contrib.auth.decorators import login_required
from django.contrib import messages
from .models import Invoice
from .forms import InvoiceForm
from clients.models import Client
from workorders.models import WorkOrder
from django.utils import timezone
# Add these imports at the top of invoices/views.py
from django.template.loader import render_to_string
from weasyprint import HTML

# Add this function to invoices/views.py
@login_required 
def invoice_pdf(request, invoice_id):
    invoice = get_object_or_404(Invoice, id=invoice_id)
    
    # Get events if linked to work order
    events = []
    if invoice.work_order:
        events = invoice.work_order.events.all().order_by('date')
    
    html_string = render_to_string("invoices/invoice_pdf.html", {
        "invoice": invoice,
        "events": events,
    })
    html = HTML(string=html_string, base_url=request.build_absolute_uri())
    pdf = html.write_pdf()

    response = HttpResponse(pdf, content_type="application/pdf")
    # Open in browser for printing
    response["Content-Disposition"] = f"inline; filename=Invoice_{invoice.invoice_number}.pdf"
    return response

@login_required
def invoice_delete(request, invoice_id):
    invoice = get_object_or_404(Invoice, id=invoice_id)
    if request.method == "POST":
        invoice.delete()
        messages.success(request, "Invoice deleted successfully.")
        return redirect('invoice_list')
    return render(request, 'invoices/invoice_confirm_delete.html', {'invoice': invoice})

@login_required
def invoice_list(request):
    query = request.GET.get('q', '')
    unpaid_invoices = Invoice.objects.filter(status='unpaid')
    in_quickbooks_invoices = Invoice.objects.filter(status='in_quickbooks')
    paid_invoices = Invoice.objects.filter(status='paid')
    
    if query:
        unpaid_invoices = unpaid_invoices.filter(
            Q(invoice_number__icontains=query) | Q(client__name__icontains=query)
        )
        in_quickbooks_invoices = in_quickbooks_invoices.filter(
            Q(invoice_number__icontains=query) | Q(client__name__icontains=query)
        )
        paid_invoices = paid_invoices.filter(
            Q(invoice_number__icontains=query) | Q(client__name__icontains=query)
        )
    
    unpaid_invoices = unpaid_invoices.order_by('-date_created')[:5]
    in_quickbooks_invoices = in_quickbooks_invoices.order_by('-date_created')[:5]
    paid_invoices = paid_invoices.order_by('-date_created')[:5]
    
    context = {
        'query': query,
        'unpaid_invoices': unpaid_invoices,
        'paid_invoices': in_quickbooks_invoices,  # Template expects 'paid_invoices' for middle section
        'overdue_invoices': paid_invoices,  # Template expects 'overdue_invoices' for final section
    }
    return render(request, 'invoices/invoice_list.html', context)

@login_required
def invoice_detail(request, invoice_id):
    invoice = get_object_or_404(Invoice, id=invoice_id)

    # grab events if there's a linked work order
    events = []
    if invoice.work_order:
        events = invoice.work_order.events.all().order_by('date')

    return render(request, 'invoices/invoice_detail.html', {
        'invoice': invoice,
        'events': events,
    })

@login_required
def invoice_update(request, invoice_id):
    invoice = get_object_or_404(Invoice, id=invoice_id)
    # Always show the invoice's existing events
    events = []
    if invoice.work_order:
        events = invoice.work_order.events.all()

    # Instantiate form with instance
    if request.method == 'POST':
        form = InvoiceForm(request.POST, instance=invoice)
    else:
        form = InvoiceForm(instance=invoice)

    # Filter work_order to that invoice's client
    if invoice.client:
        form.fields['work_order'].queryset = WorkOrder.objects.filter(
            client=invoice.client,
            status='completed'
        )

    # Handle save
    if request.method == 'POST' and form.is_valid():
        form.save()
        return redirect('invoice_detail', invoice_id=invoice.id)

    return render(request, 'invoices/invoice_form.html', {
        'form': form,
        'events': events,
        'invoice': invoice,
    })

@login_required
def mark_invoice_paid(request, invoice_id):
    invoice = get_object_or_404(Invoice, id=invoice_id)
    
    if invoice.status == 'unpaid':
        invoice.status = 'in_quickbooks'
        invoice.save()
        messages.warning(request, "Invoice marked as In QuickBooks.")
    elif invoice.status == 'in_quickbooks':
        invoice.status = 'paid'
        invoice.save()
        messages.success(request, "Invoice marked as Paid.")
    
    return redirect('invoice_list')

@login_required
def get_workorders_for_client(request):
    client_id = request.GET.get('client_id')
    work_orders = WorkOrder.objects.filter(client_id=client_id).values('id', 'job_description', 'estimated_cost')
    return JsonResponse(list(work_orders), safe=False)

# ✅ RENAMED: invoice_unpaid (already had correct name)
@login_required
def invoice_unpaid(request):
    query = request.GET.get('q', '')
    invoices = Invoice.objects.filter(status='unpaid').order_by('-date_created')
    if query:
        invoices = invoices.filter(
            Q(invoice_number__icontains=query) | Q(client__name__icontains=query)
        )
    return render(request, 'invoices/invoice_unpaid.html', {'invoices': invoices, 'query': query})

# ✅ RENAMED: invoice_paid -> invoice_in_quickbooks (shows 'in_quickbooks' status)
@login_required
def invoice_in_quickbooks(request):
    query = request.GET.get('q', '')
    invoices = Invoice.objects.filter(status='in_quickbooks').order_by('-date_created')
    if query:
        invoices = invoices.filter(
            Q(invoice_number__icontains=query) | Q(client__name__icontains=query)
        )
    return render(request, 'invoices/invoice_in_quickbooks.html', {'invoices': invoices, 'query': query})

# ✅ RENAMED: invoice_overdue -> invoice_paid (shows 'paid' status)
@login_required
def invoice_paid(request):
    query = request.GET.get('q', '')
    invoices = Invoice.objects.filter(status='paid').order_by('-date_created')
    if query:
        invoices = invoices.filter(
            Q(invoice_number__icontains=query) | Q(client__name__icontains=query)
        )
    return render(request, 'invoices/invoice_paid.html', {'invoices': invoices, 'query': query})

@login_required
def invoice_create(request):
    work_order_id = request.GET.get('work_order')
    work_order = None
    events = []

    if work_order_id:
        try:
            work_order = WorkOrder.objects.get(id=work_order_id)
            events = work_order.events.all()
        except WorkOrder.DoesNotExist:
            messages.error(request, "Invalid work order.")
            return redirect('invoice_list')

    if request.method == "POST":
        form = InvoiceForm(request.POST)
        if form.is_valid():
            invoice = form.save(commit=False)
            invoice.status = 'unpaid'
            invoice.date_created = timezone.now()

            if work_order:
                invoice.client = work_order.client
                invoice.work_order = work_order
                work_order.invoiced = True
                work_order.save()

            invoice.save()
            messages.success(request, "Invoice created successfully.")
            return redirect('invoice_detail', invoice_id=invoice.id)
    else:
        # ✅ Pre-populate form with work order data
        initial_data = {'work_order': work_order}
        if work_order and work_order.estimated_cost:
            initial_data['amount'] = work_order.estimated_cost
        
        form = InvoiceForm(initial=initial_data)

    form.fields['work_order'].queryset = WorkOrder.objects.filter(status='completed')

    return render(request, 'invoices/invoice_form.html', {
        'form': form,
        'client_id': work_order.client.id if work_order else None,
        'events': events,
        'work_order': work_order,  # ✅ Pass work order for template context
        'creating': True,  # ✅ Flag to show this is creation, not editing
    })

# ---------- AJAX VIEWS ----------

@login_required
def ajax_get_clients(request):
    """Return JSON list of clients matching the query term."""
    q = request.GET.get('q', '')
    clients = Client.objects.filter(name__icontains=q).order_by('name')[:20]
    results = [{'id': c.id, 'text': c.name} for c in clients]
    return JsonResponse(results, safe=False)

@login_required
def ajax_get_active_workorders(request):
    """Return JSON list of completed work orders for a given client."""
    client_id = request.GET.get('client_id')
    if not client_id:
        return JsonResponse([], safe=False)
    
    work_orders = WorkOrder.objects.filter(
        client_id=client_id,
        status='completed'
    )

    results = [
        {
            'id': wo.id,
            'text': f"Order #{wo.id} – {wo.job_description[:40]}{'...' if len(wo.job_description) > 40 else ''}"
        }
        for wo in work_orders
    ]
    return JsonResponse(results, safe=False)

===== invoices/forms.py =====
from django import forms
from .models import Invoice
from workorders.models import WorkOrder

class InvoiceForm(forms.ModelForm):
    class Meta:
        model = Invoice
        fields = [
            'work_order',
            'amount',
            'status',
            'notes',
        ]
        widgets = {
            'work_order': forms.Select(attrs={'class': 'form-control select2'}),
            'amount': forms.NumberInput(attrs={'class': 'form-control'}),
            'status': forms.Select(attrs={'class': 'form-control'}),
            'notes': forms.Textarea(attrs={'class': 'form-control', 'rows': 3}),
        }

===== invoices/urls.py =====
from django.urls import path
from . import views

urlpatterns = [
    path('', views.invoice_list, name='invoice_list'),
    path('create/', views.invoice_create, name='invoice_create'),
    path('<int:invoice_id>/', views.invoice_detail, name='invoice_detail'),
    path('<int:invoice_id>/edit/', views.invoice_update, name='invoice_update'),
    path('<int:invoice_id>/delete/', views.invoice_delete, name='invoice_delete'),
    
    # Status views
    path('unpaid/', views.invoice_unpaid, name='invoice_unpaid'),
    path('in-quickbooks/', views.invoice_in_quickbooks, name='invoice_in_quickbooks'),
    path('paid/', views.invoice_paid, name='invoice_paid'),
    
    path('<int:invoice_id>/mark_paid/', views.mark_invoice_paid, name='mark_invoice_paid'),

    # PDF generation
    path('<int:invoice_id>/pdf/', views.invoice_pdf, name='invoice_pdf'),

    # AJAX endpoints
    path('ajax/get_clients/', views.ajax_get_clients, name='ajax_get_clients'),
    path('ajax_get_active_workorders/', views.ajax_get_active_workorders, name='ajax_get_active_workorders'),
]

===== invoices/admin.py =====
from django.contrib import admin
from .models import Invoice
from import_export.admin import ImportExportModelAdmin
from .resources import InvoiceResource

@admin.register(Invoice)
class InvoiceAdmin(ImportExportModelAdmin):
    resource_class = InvoiceResource
    list_display = ('invoice_number', 'client', 'amount', 'status', 'date_created')
    list_filter = ('status', 'date_created')
    search_fields = ('invoice_number', 'client__name')
    ordering = ('-date_created',)
    date_hierarchy = 'date_created'
    readonly_fields = ['date_created']

    fieldsets = (
        (None, {
            'fields': ('invoice_number', 'client', 'work_order', 'amount', 'status')
        }),
        ('Dates', {
            'fields': ('date_created',)
        }),
        ('Additional Info', {
            'fields': ('notes',),
            'classes': ('collapse',)
        }),
    )

===== django_project/settings.py =====
from environ import Env
from pathlib import Path
import os

# Initialize environment variables
env = Env()
Env.read_env()

# Base directory
BASE_DIR = Path(__file__).resolve().parent.parent

# ✅ Security settings
SECURE_PROXY_SSL_HEADER = ("HTTP_X_FORWARDED_PROTO", "https")  # Required for Heroku

# Secret Key & Debug Mode
SECRET_KEY = env("DJANGO_SECRET_KEY", default="No Secret Key Found")
DEBUG = env.bool("DJANGO_DEBUG", default=False)

# ✅ Allowed Hosts
ALLOWED_HOSTS = env.list("DJANGO_ALLOWED_HOSTS", default=[
    "localhost",
    "127.0.0.1",
    "art-moving-buisness-0a734245a61f.herokuapp.com",
    "ejartmover.net",
    "www.ejartmover.net"
])

# ✅ Installed Apps
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',

    # Custom apps
    'accounts.apps.AccountsConfig',
    'pages.apps.PagesConfig',
    'workorders',
    'clients',
    'invoices',
    "calendar_app",


    # Third-party packages
    'crispy_forms',
    'crispy_bootstrap5',
    'import_export',

]

# ✅ Middleware
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

# ✅ URL Configuration
ROOT_URLCONF = 'django_project.urls'

# ✅ Templates
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'],  # Include custom templates
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

# ✅ WSGI Application
WSGI_APPLICATION = 'django_project.wsgi.application'

# ✅ Database Configuration
DATABASES = {
    "default": env.db_url("DATABASE_URL")
}


# ✅ Authentication
AUTH_USER_MODEL = 'accounts.CustomUser'

# ✅ Password Validation
AUTH_PASSWORD_VALIDATORS = [
    {'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'},
    {'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator'},
    {'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator'},
    {'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator'},
]

# ✅ Localization
LANGUAGE_CODE = 'en-us'
TIME_ZONE = 'UTC'
USE_I18N = True
USE_TZ = True

STATIC_URL = "/static/"
STATICFILES_DIRS = [BASE_DIR / "static"]  # 👈 crucial for collectstatic to find non-app static files
STATIC_ROOT = BASE_DIR / "staticfiles"
STATICFILES_STORAGE = "whitenoise.storage.CompressedManifestStaticFilesStorage"


MEDIA_URL = "/media/"
MEDIA_ROOT = BASE_DIR / "media"

# ✅ Default Primary Key
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# ✅ Crispy Forms
CRISPY_ALLOWED_TEMPLATE_PACKS = "bootstrap5"
CRISPY_TEMPLATE_PACK = "bootstrap5"

# ✅ Login & Logout
LOGIN_REDIRECT_URL = 'home'
LOGOUT_REDIRECT_URL = "/"  

# ✅ Security Settings for Production
if not DEBUG:
    SECURE_SSL_REDIRECT = env.bool("DJANGO_SECURE_SSL_REDIRECT", default=True)
    SECURE_HSTS_SECONDS = env.int("DJANGO_SECURE_HSTS_SECONDS", default=2592000)  # 30 days
    SECURE_HSTS_INCLUDE_SUBDOMAINS = env.bool("DJANGO_SECURE_HSTS_INCLUDE_SUBDOMAINS", default=True)
    SECURE_HSTS_PRELOAD = env.bool("DJANGO_SECURE_HSTS_PRELOAD", default=True)
    SESSION_COOKIE_SECURE = env.bool("DJANGO_SESSION_COOKIE_SECURE", default=True)
    CSRF_COOKIE_SECURE = env.bool("DJANGO_CSRF_COOKIE_SECURE", default=True)
else:
    SECURE_SSL_REDIRECT = False
    SECURE_HSTS_SECONDS = 0
    SECURE_HSTS_INCLUDE_SUBDOMAINS = False
    SECURE_HSTS_PRELOAD = False
    SESSION_COOKIE_SECURE = False
    CSRF_COOKIE_SECURE = False


STATICFILES_FINDERS = [
    'django.contrib.staticfiles.finders.FileSystemFinder',
    'django.contrib.staticfiles.finders.AppDirectoriesFinder',
]

IMPORT_EXPORT_USE_TRANSACTIONS = True


===== django_project/urls.py =====
from django.contrib import admin
from django.urls import path, include
from django.conf.urls.static import static
from django.conf import settings

urlpatterns = [
    path("admin/", admin.site.urls),
    path("accounts/", include("accounts.urls")),         # Custom signup and logout routes
    path("accounts/", include("django.contrib.auth.urls")),  # Login, password reset, etc.
    path("", include("pages.urls")),           
    path("workorders/", include("workorders.urls")),  # Work Orders routes
    path("clients/", include("clients.urls")),
    path("invoices/", include("invoices.urls")),
    path("workorders/", include("workorders.urls")),
    path("invoices/", include("invoices.urls")),
    path('calendar/', include('calendar_app.urls', namespace='calendar_app')),


]


if settings.DEBUG:
    urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)




===== django_project/asgi.py =====
"""
ASGI config for django_project project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.1/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')

application = get_asgi_application()


===== django_project/wsgi.py =====
"""
WSGI config for django_project project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.1/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')

application = get_wsgi_application()


===== templates/clients/client_detail.html =====
{% extends "base.html" %}
{% block title %}Client Detail{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Client Summary -->
  <div class="card mb-4">
    <div class="card-header bg-secondary text-white">
      <h5 class="mb-0">Client: {{ client.name }}</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p><strong>Email:</strong> {{ client.email|default:"Not provided" }}</p>
          <p><strong>Phone:</strong> {{ client.phone|default:"Not provided" }}</p>
        </div>
        <div class="col-md-6">
          <p><strong>Service Address:</strong> {{ client.address|default:"Not provided" }}</p>
          <p><strong>Billing Address:</strong> {{ client.billing_address|default:"Not provided" }}</p>
        </div>
      </div>
    </div>
    <div class="card-footer d-flex justify-content-between">
      <a href="{% url 'client_edit' client.id %}" class="btn btn-warning">Edit Client</a>
      <a href="{% url 'client_list' %}" class="btn btn-secondary">Back to Clients</a>
    </div>
  </div>

  <!-- Related Work Orders -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Work Orders</h5>
    </div>
    <div class="card-body">
      {% if client.work_orders.all %}
      <ul class="list-group">
        {% for order in client.work_orders.all %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <a href="{% url 'workorder_detail' order.id %}">Work Order #{{ order.id }}</a> –
              {{ order.job_description|truncatewords:6 }}
            </div>
            <span class="badge bg-info text-dark">{{ order.get_status_display }}</span>
          </li>
        {% endfor %}
      </ul>
      {% else %}
        <p>No work orders available.</p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}

===== templates/clients/client_form.html =====
{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block title %}{% if client %}Edit Client{% else %}Add New Client{% endif %}{% endblock %}
{% block content %}
<div class="container">
  <h2>{% if client %}Edit Client{% else %}Add New Client{% endif %}</h2>
  <form method="post">
    {% csrf_token %}
    {{ form|crispy }}
    <button type="submit" class="btn btn-success">{% if client %}Update Client{% else %}Create Client{% endif %}</button>
  </form>
  <a href="{% url 'client_list' %}" class="btn btn-secondary mt-3">Back to Clients</a>
</div>
{% endblock %}


===== templates/clients/client_list.html =====
{% extends "base.html" %}
{% block title %}Clients{% endblock %}
{% block content %}
<div class="container">
  <h2 class="mb-4">Clients</h2>
  
  <!-- Search Bar -->
  <form method="get" class="mb-4">
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Search by client name..." value="{{ query }}">
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
  </form>
  
  <a href="{% url 'client_create' %}" class="btn btn-success mb-3">Add New Client</a>

  <!-- Responsive Scrollable Table -->
  <div class="card shadow-sm">
    <div class="card-body table-responsive">
      <table class="table table-striped align-middle">
        <thead class="small">
          <tr>
            <th style="min-width: 120px;">Name</th>
            <th style="min-width: 180px;">Email</th>
            <th style="min-width: 120px;">Phone</th>
            <th style="min-width: 250px;">Address</th>
          </tr>
        </thead>
        <tbody>
          {% for client in clients %}
          <tr>
            <td class="text-truncate" style="max-width: 150px;">
              <a href="{% url 'client_detail' client.id %}">{{ client.name }}</a>
            </td>
            <td class="text-truncate" style="max-width: 200px;">{{ client.email }}</td>
            <td class="text-truncate" style="max-width: 150px;">{{ client.phone }}</td>
            <td class="text-truncate" style="max-width: 300px;">{{ client.address }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4">No clients found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}


===== templates/registration/login.html =====
{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Login{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Login</h2>
    <form method="post">
        {% csrf_token %}
        {{ form|crispy }}
        <button type="submit" class="btn btn-primary">Login</button>
    </form>
    <p class="mt-3">Don't have an account? <a href="{% url 'signup' %}">Sign up here</a>.</p>
</div>
{% endblock %}


===== templates/registration/logout.html =====
{% extends "base.html" %}

{% block title %}Logout{% endblock %}

{% block content %}
<div class="container text-center mt-4">
    <h2>You have been logged out</h2>
    <a href="{% url 'login' %}" class="btn btn-primary">Login Again</a>
</div>
{% endblock %}


===== templates/registration/signup.html =====
{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Sign Up{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Sign Up</h2>
    <form method="post">
        {% csrf_token %}
        {{ form|crispy }}
        <button type="submit" class="btn btn-primary">Sign Up</button>
    </form>
    <p class="mt-3">Already have an account? <a href="{% url 'login' %}">Login here</a>.</p>
</div>
{% endblock %}


===== templates/home.html =====
{% extends "base.html" %}
{% block title %}Dashboard – Art Moving Business{% endblock %}

{% block content %}
  <!-- Welcome Hero -->
  <div class="text-center mb-4">
    <h2 class="fw-bold">Welcome back, {{ user.username }} 👋</h2>
    <p class="text-muted">Here’s what’s happening today in your business.</p>
  </div>

  <!-- Quick Action Buttons -->
  <div class="row g-3 justify-content-center">
    <div class="col-lg-3 col-md-4 col-sm-6">
      <a href="{% url 'workorder_list' %}" class="btn btn-primary w-100 py-4 shadow-sm d-flex flex-column align-items-center">
        <i class="bi bi-card-checklist fs-1 mb-2"></i>
        <span>Work Orders</span>
      </a>
    </div>
    <div class="col-lg-3 col-md-4 col-sm-6">
      <a href="{% url 'client_list' %}" class="btn btn-warning w-100 py-4 shadow-sm d-flex flex-column align-items-center">
        <i class="bi bi-people-fill fs-1 mb-2"></i>
        <span>Clients</span>
      </a>
    </div>
    <div class="col-lg-3 col-md-4 col-sm-6">
      <a href="{% url 'invoice_list' %}" class="btn btn-danger w-100 py-4 shadow-sm d-flex flex-column align-items-center">
        <i class="bi bi-receipt fs-1 mb-2"></i>
        <span>Invoicing</span>
      </a>
    </div>
  </div>

  <!-- Calendar & Legend -->
  {% now "m-d-y" as today %}
  <div class="card shadow-sm mt-4">
    <div class="card-header d-flex align-items-center">
      <div class="btn-group me-3">
        <a href="{% url 'home' %}" class="btn btn-outline-secondary">Month</a>
        <a href="{% url 'calendar_app:week_detail' today %}" class="btn btn-outline-primary">Week</a>
        <a href="{% url 'calendar_app:day_detail' today %}" class="btn btn-outline-primary">Day</a>
      </div>
      <h5 class="mb-0">Calendar</h5>
    </div>
    <div class="card-body">
      <!-- Legend -->
      <div class="mb-3">
        <span class="badge bg-secondary me-2">Work Order Events</span>
        <small class="d-block text-muted mt-1">
          Work order events are color-coded uniquely per job.
        </small>
      </div>
      <!-- FullCalendar -->
      <div id="calendar"></div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  function toMMDDYY(iso) {
    let [Y, M, D] = iso.split('-');
    return `${M}-${D}-${Y.slice(-2)}`;
  }

  const calendarEl = document.getElementById("calendar");
  if (!calendarEl) {
    console.error("Calendar element not found!");
    return;
  }

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridMonth",
    height: 'auto',
    events: async function(fetchInfo, success, fail) {
      try {
        const workOrders = await fetch("/workorders/calendar-data/workorders/").then(r => r.json());
        success(workOrders);  // ✅ Only load Work Order events
      } catch (e) {
        console.error("Calendar fetch error:", e);
        fail(e);
      }
    },
    eventClick: info => {
      if (info.event.url) {
        window.location.href = info.event.url;
        info.jsEvent.preventDefault();
      }
    },
    dateClick: info => {
      const mmddyy = toMMDDYY(info.dateStr);
      window.location.href = `/calendar/day/${mmddyy}/`;
    }
  });

  calendar.render();
});
</script>
{% endblock %}


===== templates/calendar/day_detail.html =====
{% extends "base.html" %}
{% block title %}Day: {{ day|date:"F j, Y" }}{% endblock %}

{% block content %}
  {% now "m-d-y" as today %}

  <!-- View Switcher Buttons -->
  <div class="mb-3 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'home' %}" class="btn btn-outline-secondary w-100 w-sm-auto">Month</a>
      <a href="{% url 'calendar_app:week_detail' today %}" class="btn btn-outline-primary w-100 w-sm-auto">Week</a>
      <a href="{% url 'calendar_app:day_detail' today %}" class="btn btn-outline-secondary w-100 w-sm-auto">Day</a>
    </div>
  </div>

  <!-- Search -->
  <form method="get" class="mb-3">
    <input type="text" name="q" class="form-control" placeholder="Search…" value="{{ query }}">
  </form>

  <!-- Calendar -->
  <div id="calendar" class="mb-5"></div>

  <!-- Printable Details -->
  <div id="printable-details" class="card shadow-sm p-4">
    <h4 class="mb-3">Events for {{ day|date:"l, F j, Y" }}</h4>
    
    {% if events %}
      <ul class="list-group mb-3">
        {% for evt in events %}
          <li class="list-group-item">
            <strong>{{ evt.get_event_type_display }}</strong> –
            <a href="{% url 'workorder_detail' evt.work_order.id %}">
              {{ evt.work_order.client.name }}
            </a><br>
            <small class="text-muted">{{ evt.address }}</small>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No events scheduled.</p>
    {% endif %}

    <button onclick="window.print()" class="btn btn-secondary mt-4">🖨️ Print This Page</button>
  </div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  function toMMDDYY(iso) {
    let [Y, M, D] = iso.split('-');
    return `${M}-${D}-${Y.slice(-2)}`;
  }

  async function fetchSources(info, success, fail) {
    try {
      const wo = await fetch("/workorders/calendar-data/workorders/").then(r => r.json());
      success(wo);
    } catch (e) {
      console.error("Calendar fetch error:", e);
      fail(e);
    }
  }

  function goToEventUrl(info) {
    if (info.event.url) {
      window.location.href = info.event.url;
      info.jsEvent.preventDefault();
    }
  }

  const calendarEl = document.getElementById("calendar");
  if (!calendarEl) return;

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridDay",
    height: "auto",
    initialDate: "{{ day|date:'Y-m-d' }}",
    events: fetchSources,
    eventClick: goToEventUrl,
    // ✅ Add navigation handler to redirect to new date
    datesSet: function(info) {
      const currentDate = "{{ day|date:'Y-m-d' }}";
      const newDate = info.start.toISOString().split('T')[0];
      
      // Only redirect if the date actually changed (not on initial load)
      if (newDate !== currentDate) {
        const mmddyy = toMMDDYY(newDate);
        window.location.href = `/calendar/day/${mmddyy}/`;
      }
    }
  });

  calendar.render();
});
</script>
{% endblock %}

===== templates/calendar/week_detail.html =====
{% extends "base.html" %}
{% block title %}Week of {{ start|date:"M j, Y" }}{% endblock %}

{% block content %}
  {% now "m-d-y" as today %}

  <!-- View Navigation Buttons -->
  <div class="mb-3 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'home' %}" class="btn btn-outline-secondary w-100 w-sm-auto">Month</a>
      <a href="{% url 'calendar_app:week_detail' today %}" class="btn btn-outline-primary w-100 w-sm-auto">Week</a>
      <a href="{% url 'calendar_app:day_detail' today %}" class="btn btn-outline-secondary w-100 w-sm-auto">Day</a>
    </div>
  </div>

  <!-- Search -->
  <form method="get" class="mb-3">
    <input type="text" name="q" class="form-control" placeholder="Search…" value="{{ query }}">
  </form>

  <!-- Calendar -->
  <div id="calendar"></div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  function toMMDDYY(iso) {
    let [Y, M, D] = iso.split("-");
    return `${M}-${D}-${Y.slice(-2)}`;
  }

  async function fetchSources(info, success, fail) {
    try {
      const wo = await fetch("/workorders/calendar-data/workorders/").then(r => r.json());
      success(wo);  // 🔥 Removed invoice events
    } catch (e) {
      console.error("Calendar fetch error:", e);
      fail(e);
    }
  }

  function goToEventUrl(info) {
    if (info.event.url) {
      window.location.href = info.event.url;
      info.jsEvent.preventDefault();
    }
  }

  function goToDayDetail(info) {
    const mmddyy = toMMDDYY(info.dateStr);
    window.location.href = `/calendar/day/${mmddyy}/`;
  }

  const calendarEl = document.getElementById("calendar");
  if (!calendarEl) return console.error("Calendar element not found!");

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridWeek",
    height: "auto",
    initialDate: "{{ start|date:'Y-m-d' }}",
    events: fetchSources,
    eventClick: goToEventUrl,
    dateClick: goToDayDetail
  });

  calendar.render();

  // Make day headers clickable → route to day detail page
  setTimeout(() => {
    document.querySelectorAll(".fc-col-header-cell").forEach((th, i) => {
      const start = new Date("{{ start|date:'Y-m-d' }}");
      const thisDate = new Date(start.getFullYear(), start.getMonth(), start.getDate() + i);

      const mm = String(thisDate.getMonth() + 1).padStart(2, '0');
      const dd = String(thisDate.getDate()).padStart(2, '0');
      const yy = String(thisDate.getFullYear()).slice(-2);

      th.style.cursor = "pointer";
      th.style.textDecoration = "underline";
      th.title = "Go to Day Detail";

      th.addEventListener("click", () => {
        window.location.href = `/calendar/day/${mm}-${dd}-${yy}/`;
      });
    });
  }, 0);
});
</script>
{% endblock %}


===== templates/invoices/invoice_paid.html =====
{% extends "base.html" %}
{% block title %}Paid Invoices{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">Paid</h2>

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'invoice_unpaid' %}" class="btn btn-outline-danger w-100 w-sm-auto">Not in QuickBooks</a>
      <a href="{% url 'invoice_in_quickbooks' %}" class="btn btn-outline-warning w-100 w-sm-auto">In QuickBooks</a>
      <a href="{% url 'invoice_paid' %}" class="btn btn-outline-success w-100 w-sm-auto">Paid</a>
    </div>
  </div>

  <!-- Search Bar -->
  <form method="get" class="mb-4">
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Search by invoice number or client name..." value="{{ query }}">
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
  </form>

  <div class="card shadow-sm">
    <div class="card-header bg-success text-white">Paid</div>
    <div class="card-body p-0">
      {% if invoices %}
        <!-- Desktop Table View -->
        <div class="d-none d-md-block">
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle mb-0">
              <thead class="small">
                <tr><th>Invoice #</th><th>Client</th><th>Amount</th><th>Actions</th></tr>
              </thead>
              <tbody>
                {% for inv in invoices %}
                <tr>
                  <td>{{ inv.invoice_number }}</td>
                  <td>{{ inv.client.name }}</td>
                  <td>${{ inv.amount }}</td>
                  <td>
                    <div class="d-flex flex-row gap-1">
                      <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
                      <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Mobile Card View -->
        <div class="d-md-none">
          {% for inv in invoices %}
          <div class="border-bottom p-3">
            <div class="mb-2">
              <div><strong>Invoice #{{ inv.invoice_number }}</strong></div>
              <div class="text-muted small">{{ inv.client.name }}</div>
              <div class="text-success fw-bold">${{ inv.amount }}</div>
            </div>
            <div class="d-flex flex-column gap-2">
              <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
              <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
      <p class="p-3 mb-0">No paid invoices found.</p>
      {% endif %}
    </div>
  </div>

  <!-- Navigation -->
  <div class="text-center mt-4">
    <a href="{% url 'invoice_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Invoice Overview</a>
    <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>
</div>
{% endblock %}

===== templates/invoices/invoice_unpaid.html =====
{% extends "base.html" %}
{% block title %}Not in QuickBooks{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">Not in QuickBooks</h2>

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'invoice_unpaid' %}" class="btn btn-outline-danger w-100 w-sm-auto">Not in QuickBooks</a>
      <a href="{% url 'invoice_in_quickbooks' %}" class="btn btn-outline-warning w-100 w-sm-auto">In QuickBooks</a>
      <a href="{% url 'invoice_paid' %}" class="btn btn-outline-success w-100 w-sm-auto">Paid</a>
    </div>
  </div>

  <!-- Search Bar -->
  <form method="get" class="mb-4">
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Search by invoice number or client name..." value="{{ query }}">
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
  </form>

  <div class="card shadow-sm">
    <div class="card-header bg-danger text-white">Not in QuickBooks</div>
    <div class="card-body p-0">
      {% if invoices %}
        <!-- Desktop Table View -->
        <div class="d-none d-md-block">
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle mb-0">
              <thead class="small">
                <tr><th>Invoice #</th><th>Client</th><th>Amount</th><th>Actions</th></tr>
              </thead>
              <tbody>
                {% for inv in invoices %}
                <tr>
                  <td>{{ inv.invoice_number }}</td>
                  <td>{{ inv.client.name }}</td>
                  <td>${{ inv.amount }}</td>
                  <td>
                    <div class="d-flex flex-row gap-1">
                      <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
                      <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
                      <form method="post" action="{% url 'mark_invoice_paid' inv.id %}" class="d-inline">{% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-success">Mark as In QB</button>
                      </form>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Mobile Card View -->
        <div class="d-md-none">
          {% for inv in invoices %}
          <div class="border-bottom p-3">
            <div class="mb-2">
              <div><strong>Invoice #{{ inv.invoice_number }}</strong></div>
              <div class="text-muted small">{{ inv.client.name }}</div>
              <div class="text-success fw-bold">${{ inv.amount }}</div>
            </div>
            <div class="d-flex flex-column gap-2">
              <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
              <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
              <form method="post" action="{% url 'mark_invoice_paid' inv.id %}">{% csrf_token %}
                <button type="submit" class="btn btn-sm btn-success w-100">Mark as In QuickBooks</button>
              </form>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
      <p class="p-3 mb-0">No invoices found.</p>
      {% endif %}
    </div>
  </div>

  <!-- Navigation Buttons -->
  <div class="text-center mt-4">
    <a href="{% url 'invoice_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Invoice Overview</a>
    <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>
</div>
{% endblock %}

===== templates/invoices/invoice_pdf.html =====
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice #{{ invoice.invoice_number }}</title>
  <style>
    body { 
      font-family: 'Arial', sans-serif; 
      color: #333; 
      margin: 1rem;
      line-height: 1.4;
    }
    
    .header { 
      text-align: center; 
      margin-bottom: 2rem; 
      border-bottom: 2px solid #28a745;
      padding-bottom: 1rem;
    }
    
    .logo { 
      font-size: 1.5rem; 
      font-weight: bold; 
      margin-bottom: 0.5rem;
    }
    
    .invoice-title {
      font-size: 1.8rem;
      margin: 0;
      color: #28a745;
    }
    
    .invoice-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
      background-color: #f8f9fa;
      padding: 1rem;
      border-radius: 0.5rem;
      border-left: 4px solid #28a745;
    }
    
    .invoice-details {
      text-align: right;
    }
    
    .section { 
      margin-bottom: 1.5rem; 
      break-inside: avoid;
    }
    
    .section-title { 
      background-color: #f8f9fa;
      border-left: 4px solid #28a745;
      padding: 0.5rem 1rem;
      margin-bottom: 1rem; 
      font-size: 1.1rem;
      font-weight: bold;
      color: #495057;
    }
    
    .info-row {
      display: flex;
      margin-bottom: 0.5rem;
    }
    
    .info-label { 
      font-weight: bold; 
      width: 150px; 
      display: inline-block;
      color: #495057;
    }
    
    .info-value {
      flex: 1;
    }
    
    .status-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      display: inline-block;
      font-weight: bold;
    }
    
    .status-unpaid {
      background-color: #dc3545;
      color: white;
    }
    
    .status-in-quickbooks {
      background-color: #ffc107;
      color: #212529;
    }
    
    .status-paid {
      background-color: #28a745;
      color: white;
    }
    
    .amount-section {
      background-color: #e9ecef;
      border: 2px solid #28a745;
      border-radius: 0.5rem;
      padding: 1.5rem;
      text-align: center;
      margin: 1.5rem 0;
    }
    
    .amount-label {
      font-size: 1.1rem;
      color: #495057;
      margin-bottom: 0.5rem;
    }
    
    .amount-value {
      font-size: 2rem;
      font-weight: bold;
      color: #28a745;
    }
    
    .event-item {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 0.25rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
    }
    
    .event-type {
      font-weight: bold;
      color: #28a745;
      margin-bottom: 0.25rem;
    }
    
    .event-details {
      font-size: 0.9rem;
      color: #6c757d;
    }
    
    .two-column {
      display: flex;
      gap: 2rem;
    }
    
    .column {
      flex: 1;
    }
    
    .notes-section {
      background-color: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 0.25rem;
      padding: 1rem;
      margin: 1rem 0;
    }
    
    .work-order-link {
      background-color: #d1ecf1;
      border: 1px solid #bee5eb;
      border-radius: 0.25rem;
      padding: 1rem;
      margin: 1rem 0;
    }
    
    .footer {
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px solid #dee2e6;
      text-align: center;
      font-size: 0.9rem;
      color: #6c757d;
    }
    
    @media print {
      body { margin: 0; }
      .section { break-inside: avoid; }
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo">EJ Art Moving</div>
    <h1 class="invoice-title">Invoice #{{ invoice.invoice_number }}</h1>
  </div>

  <!-- Invoice Summary -->
  <div class="invoice-info">
    <div>
      <h3 style="margin: 0 0 0.5rem 0; color: #28a745;">Invoice Information</h3>
      <div><strong>Invoice Number:</strong> {{ invoice.invoice_number }}</div>
      <div><strong>Date Created:</strong> {{ invoice.date_created|date:"F j, Y" }}</div>
    </div>
    <div class="invoice-details">
      <div><strong>Status:</strong> 
        <span class="status-badge 
          {% if invoice.status == 'unpaid' %}status-unpaid
          {% elif invoice.status == 'in_quickbooks' %}status-in-quickbooks  
          {% else %}status-paid{% endif %}">
          {{ invoice.get_status_display }}
        </span>
      </div>
      {% if invoice.work_order %}
        <div style="margin-top: 0.5rem;"><strong>Work Order:</strong> #{{ invoice.work_order.id }}</div>
      {% endif %}
    </div>
  </div>

  <!-- Client Information -->
  <div class="section">
    <div class="section-title">Bill To</div>
    <div class="two-column">
      <div class="column">
        <div class="info-row">
          <span class="info-label">Name:</span>
          <span class="info-value">{{ invoice.client.name }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Email:</span>
          <span class="info-value">{{ invoice.client.email|default:"Not provided" }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Phone:</span>
          <span class="info-value">{{ invoice.client.phone|default:"Not provided" }}</span>
        </div>
      </div>
      <div class="column">
        <div class="info-row">
          <span class="info-label">Service Address:</span>
          <span class="info-value">{{ invoice.client.address|default:"Not provided" }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Billing Address:</span>
          <span class="info-value">{{ invoice.client.billing_address|default:"Not provided" }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Work Order Information (if linked) -->
  {% if invoice.work_order %}
  <div class="section">
    <div class="section-title">Work Order Details</div>
    <div class="work-order-link">
      <div class="two-column">
        <div class="column">
          <div class="info-row">
            <span class="info-label">Work Order ID:</span>
            <span class="info-value">#{{ invoice.work_order.id }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Description:</span>
            <span class="info-value">{{ invoice.work_order.job_description|default:"No description provided" }}</span>
          </div>
        </div>
        <div class="column">
          <div class="info-row">
            <span class="info-label">Status:</span>
            <span class="info-value">{{ invoice.work_order.get_status_display }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Completed:</span>
            <span class="info-value">
              {% if invoice.work_order.completed_at %}
                {{ invoice.work_order.completed_at|date:"F j, Y" }}
              {% else %}
                Not completed
              {% endif %}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scheduled Events (if work order has events) -->
  {% if events %}
  <div class="section">
    <div class="section-title">Services Provided</div>
    {% for event in events %}
      <div class="event-item">
        <div class="event-type">{{ event.get_event_type_display }}</div>
        <div class="event-details">
          {% if event.address %}
            <strong>Location:</strong> {{ event.address }}<br>
          {% endif %}
          {% if event.date %}
            <strong>Date:</strong> {{ event.date|date:"F j, Y" }}
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
  {% endif %}
  {% endif %}

  <!-- Invoice Amount -->
  <div class="amount-section">
    <div class="amount-label">Total Amount Due</div>
    <div class="amount-value">${{ invoice.amount }}</div>
  </div>

  <!-- Notes -->
  {% if invoice.notes %}
  <div class="section">
    <div class="section-title">Notes</div>
    <div class="notes-section">
      {{ invoice.notes|linebreaks }}
    </div>
  </div>
  {% endif %}

  <!-- Payment Information -->
  <div class="section">
    <div class="section-title">Payment Information</div>
    <div style="background-color: #f8f9fa; padding: 1rem; border-radius: 0.25rem;">
      <p><strong>Please make checks payable to:</strong> EJ Art Moving</p>
      <p><strong>Questions about this invoice?</strong> Contact us for assistance.</p>
      {% if invoice.status == 'unpaid' %}
        <p style="color: #dc3545; font-weight: bold;">Payment is due upon receipt.</p>
      {% elif invoice.status == 'paid' %}
        <p style="color: #28a745; font-weight: bold;">✓ This invoice has been paid. Thank you!</p>
      {% endif %}
    </div>
  </div>

  <div class="footer">
    <p>Generated on {{ "now"|date:"F j, Y g:i A" }} | EJ Art Moving Business Management System</p>
    <p>Thank you for your business!</p>
  </div>

</body>
</html>

===== templates/invoices/invoice_confirm_delete.html =====
{% extends "base.html" %}
{% block title %}Delete Invoice{% endblock %}
{% block content %}
<div class="container py-4">

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'invoice_unpaid' %}" class="btn btn-outline-danger w-100 w-sm-auto">Not In QuickBooks</a>
      <a href="{% url 'invoice_in_quickbooks' %}" class="btn btn-outline-warning w-100 w-sm-auto">In QuickBooks</a>
      <a href="{% url 'invoice_paid' %}" class="btn btn-outline-success w-100 w-sm-auto">Paid</a>
    </div>
  </div>

  <!-- Delete Confirmation -->
  <div class="card shadow-sm">
    <div class="card-header bg-danger text-white">
      <h5 class="mb-0">Delete Invoice #{{ invoice.invoice_number }}</h5>
    </div>
    <div class="card-body">
      <p>Are you sure you want to delete this invoice?</p>
      <form method="post">
        {% csrf_token %}
        <div class="d-flex flex-column flex-sm-row gap-2">
          <button type="submit" class="btn btn-danger w-100 w-sm-auto">Yes, Delete It</button>
          <a href="{% url 'invoice_detail' invoice.id %}" class="btn btn-secondary w-100 w-sm-auto">Cancel</a>
        </div>
      </form>
    </div>
  </div>

  <div class="text-center mt-4">
    <a href="{% url 'invoice_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Invoices</a>
    <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>

</div>
{% endblock %}

===== templates/invoices/invoice_in_quickbooks.html =====
{% extends "base.html" %}
{% block title %}In QuickBooks{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">In QuickBooks</h2>

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'invoice_unpaid' %}" class="btn btn-outline-danger w-100 w-sm-auto">Not in QuickBooks</a>
      <a href="{% url 'invoice_in_quickbooks' %}" class="btn btn-outline-warning w-100 w-sm-auto">In QuickBooks</a>
      <a href="{% url 'invoice_paid' %}" class="btn btn-outline-success w-100 w-sm-auto">Paid</a>
    </div>
  </div>

  <!-- Search Bar -->
  <form method="get" class="mb-4">
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Search by invoice number or client name..." value="{{ query }}">
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
  </form>

  <div class="card shadow-sm">
    <div class="card-header bg-warning text-white">In QuickBooks</div>
    <div class="card-body p-0">
      {% if invoices %}
        <!-- Desktop Table View -->
        <div class="d-none d-md-block">
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle mb-0">
              <thead class="small">
                <tr><th>Invoice #</th><th>Client</th><th>Amount</th><th>Actions</th></tr>
              </thead>
              <tbody>
                {% for inv in invoices %}
                <tr>
                  <td>{{ inv.invoice_number }}</td>
                  <td>{{ inv.client.name }}</td>
                  <td>${{ inv.amount }}</td>
                  <td>
                    <div class="d-flex flex-row gap-1">
                      <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
                      <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
                      <form method="post" action="{% url 'mark_invoice_paid' inv.id %}" class="d-inline">{% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-success">Mark as Paid</button>
                      </form>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Mobile Card View -->
        <div class="d-md-none">
          {% for inv in invoices %}
          <div class="border-bottom p-3">
            <div class="mb-2">
              <div><strong>Invoice #{{ inv.invoice_number }}</strong></div>
              <div class="text-muted small">{{ inv.client.name }}</div>
              <div class="text-success fw-bold">${{ inv.amount }}</div>
            </div>
            <div class="d-flex flex-column gap-2">
              <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
              <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
              <form method="post" action="{% url 'mark_invoice_paid' inv.id %}">{% csrf_token %}
                <button type="submit" class="btn btn-sm btn-success w-100">Mark as Paid</button>
              </form>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
      <p class="p-3 mb-0">No invoices in QuickBooks found.</p>
      {% endif %}
    </div>
  </div>

  <!-- Navigation Buttons -->
  <div class="text-center mt-4">
    <a href="{% url 'invoice_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Invoice Overview</a>
    <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>
</div>
{% endblock %}

===== templates/invoices/invoice_list.html =====
{% extends "base.html" %}
{% block title %}Invoice Overview{% endblock %}
{% block content %}
<div class="container">
  <h2 class="mb-4">Invoice Overview</h2>

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'invoice_unpaid' %}" class="btn btn-outline-danger w-100 w-sm-auto">Not in QuickBooks</a>
      <a href="{% url 'invoice_in_quickbooks' %}" class="btn btn-outline-warning w-100 w-sm-auto">In QuickBooks</a>
      <a href="{% url 'invoice_paid' %}" class="btn btn-outline-success w-100 w-sm-auto">Paid</a>
    </div>
  </div>

  <!-- Search Bar -->
  <form method="get" class="mb-4">
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Search by invoice number or client name..." value="{{ query }}">
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
  </form>

  <!-- Not In QuickBooks -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-danger text-white position-relative">
      <h5 class="mb-0">
        <a href="{% url 'invoice_unpaid' %}" class="stretched-link text-white text-decoration-none">Not in QuickBooks</a>
      </h5>
    </div>
    <div class="card-body p-0">
      {% if unpaid_invoices %}
        <!-- Desktop Table View -->
        <div class="d-none d-md-block">
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle mb-0">
              <thead class="small">
                <tr><th>Invoice #</th><th>Client</th><th>Amount</th><th>Actions</th></tr>
              </thead>
              <tbody>
                {% for inv in unpaid_invoices %}
                <tr>
                  <td>{{ inv.invoice_number }}</td>
                  <td>{{ inv.client.name }}</td>
                  <td>${{ inv.amount }}</td>
                  <td>
                    <div class="d-flex flex-row gap-1">
                      <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
                      <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
                      <form method="post" action="{% url 'mark_invoice_paid' inv.id %}" class="d-inline">{% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-success">Mark as In QB</button>
                      </form>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Mobile Card View -->
        <div class="d-md-none">
          {% for inv in unpaid_invoices %}
          <div class="border-bottom p-3">
            <div class="mb-2">
              <div><strong>Invoice #{{ inv.invoice_number }}</strong></div>
              <div class="text-muted small">{{ inv.client.name }}</div>
              <div class="text-success fw-bold">${{ inv.amount }}</div>
            </div>
            <div class="d-flex flex-column gap-2">
              <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
              <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
              <form method="post" action="{% url 'mark_invoice_paid' inv.id %}">{% csrf_token %}
                <button type="submit" class="btn btn-sm btn-success w-100">Mark as In QuickBooks</button>
              </form>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}<p class="p-3 mb-0">No unpaid invoices found.</p>{% endif %}
    </div>
  </div>

  <!-- In QuickBooks -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-warning text-white position-relative">
      <h5 class="mb-0">
        <a href="{% url 'invoice_in_quickbooks' %}" class="stretched-link text-white text-decoration-none">In QuickBooks</a>
      </h5>
    </div>
    <div class="card-body p-0">
      {% if paid_invoices %}
        <!-- Desktop Table View -->
        <div class="d-none d-md-block">
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle mb-0">
              <thead class="small">
                <tr><th>Invoice #</th><th>Client</th><th>Amount</th><th>Actions</th></tr>
              </thead>
              <tbody>
                {% for inv in paid_invoices %}
                <tr>
                  <td>{{ inv.invoice_number }}</td>
                  <td>{{ inv.client.name }}</td>
                  <td>${{ inv.amount }}</td>
                  <td>
                    <div class="d-flex flex-row gap-1">
                      <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
                      <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
                      <form method="post" action="{% url 'mark_invoice_paid' inv.id %}" class="d-inline">{% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-success">Mark as Paid</button>
                      </form>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Mobile Card View -->
        <div class="d-md-none">
          {% for inv in paid_invoices %}
          <div class="border-bottom p-3">
            <div class="mb-2">
              <div><strong>Invoice #{{ inv.invoice_number }}</strong></div>
              <div class="text-muted small">{{ inv.client.name }}</div>
              <div class="text-success fw-bold">${{ inv.amount }}</div>
            </div>
            <div class="d-flex flex-column gap-2">
              <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
              <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
              <form method="post" action="{% url 'mark_invoice_paid' inv.id %}">{% csrf_token %}
                <button type="submit" class="btn btn-sm btn-success w-100">Mark as Paid</button>
              </form>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}<p class="p-3 mb-0">No invoices in QuickBooks found.</p>{% endif %}
    </div>
  </div>

  <!-- Paid Invoices -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-success text-white position-relative">
      <h5 class="mb-0">
        <a href="{% url 'invoice_paid' %}" class="stretched-link text-white text-decoration-none">Paid</a>
      </h5>
    </div>
    <div class="card-body p-0">
      {% if overdue_invoices %}
        <!-- Desktop Table View -->
        <div class="d-none d-md-block">
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle mb-0">
              <thead class="small">
                <tr><th>Invoice #</th><th>Client</th><th>Amount</th><th>Actions</th></tr>
              </thead>
              <tbody>
                {% for inv in overdue_invoices %}
                <tr>
                  <td>{{ inv.invoice_number }}</td>
                  <td>{{ inv.client.name }}</td>
                  <td>${{ inv.amount }}</td>
                  <td>
                    <div class="d-flex flex-row gap-1">
                      <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
                      <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Mobile Card View -->
        <div class="d-md-none">
          {% for inv in overdue_invoices %}
          <div class="border-bottom p-3">
            <div class="mb-2">
              <div><strong>Invoice #{{ inv.invoice_number }}</strong></div>
              <div class="text-muted small">{{ inv.client.name }}</div>
              <div class="text-success fw-bold">${{ inv.amount }}</div>
            </div>
            <div class="d-flex flex-column gap-2">
              <a href="{% url 'invoice_detail' inv.id %}" class="btn btn-sm btn-info">View</a>
              <a href="{% url 'invoice_update' inv.id %}" class="btn btn-sm btn-warning">Edit</a>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}<p class="p-3 mb-0">No paid invoices found.</p>{% endif %}
    </div>
  </div>

  <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto mt-3">Back to Dashboard</a>
</div>
{% endblock %}

===== templates/invoices/invoice_form.html =====
{% extends "base.html" %}
{% load crispy_forms_tags static %}
{% block title %}{% if creating %}Create Invoice{% else %}Edit Invoice{% endif %}{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">{% if creating %}Create Invoice{% else %}Edit Invoice{% endif %}</h2>

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'invoice_unpaid' %}" class="btn btn-outline-danger w-100 w-sm-auto">Not In QuickBooks</a>
      <a href="{% url 'invoice_in_quickbooks' %}" class="btn btn-outline-warning w-100 w-sm-auto">In QuickBooks</a>
      <a href="{% url 'invoice_paid' %}" class="btn btn-outline-success w-100 w-sm-auto">Paid</a>
    </div>
  </div>

  <!-- Work Order Information Reference (Create Mode) -->
  {% if creating and work_order %}
  <div class="card mb-4 bg-light">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">Creating Invoice For This Job</h5>
    </div>
    <div class="card-body">
      
      <!-- Complete Client Information -->
      <h6>Client Information</h6>
      <div class="row mb-3">
        <div class="col-md-6">
          <p class="mb-1"><strong>Name:</strong> {{ work_order.client.name }}</p>
          <p class="mb-1"><strong>Email:</strong> {{ work_order.client.email|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Phone:</strong> {{ work_order.client.phone|default:"Not provided" }}</p>
        </div>
        <div class="col-md-6">
          <p class="mb-1"><strong>Address:</strong> {{ work_order.client.address|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Billing Address:</strong> 
            {% if work_order.client.billing_address %}
              {{ work_order.client.billing_address }}
            {% else %}
              <em>Not specified</em>
            {% endif %}
          </p>
        </div>
      </div>

      <!-- Work Order Details -->
      <h6>Work Order Details</h6>
      <div class="row mb-3">
        <div class="col-md-6">
          <p class="mb-1"><strong>Work Order ID:</strong> {{ work_order.id }}</p>
          <p class="mb-1"><strong>Status:</strong> {{ work_order.get_status_display }}</p>
        </div>
        <div class="col-md-6">
          <p class="mb-1"><strong>Estimated Cost:</strong> ${{ work_order.estimated_cost }}</p>
        </div>
      </div>
      
      <!-- Job Description -->
      {% if work_order.job_description %}
      <h6>Job Description</h6>
      <div class="bg-white p-3 rounded border mb-3">
        {{ work_order.job_description }}
      </div>
      {% endif %}

      <!-- Scheduled Events -->
      {% if events %}
      <h6>Scheduled Events</h6>
      <div class="row">
        {% for event in events %}
        <div class="col-md-6 mb-2">
          <div class="card border">
            <div class="card-body py-2">
              <h6 class="card-title text-primary mb-1">{{ event.get_event_type_display }}</h6>
              <p class="card-text mb-1 small"><strong>Date:</strong> {{ event.date|date:"M d, Y" }}</p>
              <p class="card-text mb-0 small"><strong>Address:</strong> {{ event.address }}</p>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
        <p class="mb-0"><strong>Scheduled Events:</strong> No events scheduled</p>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Work Order Information Reference (Edit Mode) -->
  {% if not creating and invoice.work_order %}
  <div class="card mb-4 bg-light">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">Work Order Reference Information</h5>
    </div>
    <div class="card-body">
      
      <!-- Complete Client Information -->
      <h6>Client Information</h6>
      <div class="row mb-3">
        <div class="col-md-6">
          <p class="mb-1"><strong>Name:</strong> {{ invoice.client.name }}</p>
          <p class="mb-1"><strong>Email:</strong> {{ invoice.client.email|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Phone:</strong> {{ invoice.client.phone|default:"Not provided" }}</p>
        </div>
        <div class="col-md-6">
          <p class="mb-1"><strong>Address:</strong> {{ invoice.client.address|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Billing Address:</strong> 
            {% if invoice.client.billing_address %}
              {{ invoice.client.billing_address }}
            {% else %}
              <em>Not specified</em>
            {% endif %}
          </p>
        </div>
      </div>

      <!-- Work Order Details -->
      <h6>Work Order Details</h6>
      <div class="row mb-3">
        <div class="col-md-6">
          <p class="mb-1"><strong>Work Order ID:</strong> {{ invoice.work_order.id }}</p>
          <p class="mb-1"><strong>Status:</strong> {{ invoice.work_order.get_status_display }}</p>
        </div>
        <div class="col-md-6">
          <p class="mb-1"><strong>Estimated Cost:</strong> ${{ invoice.work_order.estimated_cost }}</p>
        </div>
      </div>
      
      <!-- Job Description -->
      {% if invoice.work_order.job_description %}
      <h6>Job Description</h6>
      <div class="bg-white p-3 rounded border mb-3">
        {{ invoice.work_order.job_description }}
      </div>
      {% endif %}

      <!-- Scheduled Events -->
      {% if events %}
      <h6>Scheduled Events</h6>
      <div class="row">
        {% for event in events %}
        <div class="col-md-6 mb-2">
          <div class="card border">
            <div class="card-body py-2">
              <h6 class="card-title text-primary mb-1">{{ event.get_event_type_display }}</h6>
              <p class="card-text mb-1 small"><strong>Date:</strong> {{ event.date|date:"M d, Y" }}</p>
              <p class="card-text mb-0 small"><strong>Address:</strong> {{ event.address }}</p>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
        <p class="mb-0"><strong>Scheduled Events:</strong> No events scheduled</p>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Invoice Form -->
  <div class="card">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">{% if creating %}Invoice Details{% else %}Edit Invoice Details{% endif %}</h5>
    </div>
    <div class="card-body">
      <form method="post" id="invoice-form">
        {% csrf_token %}
        <input type="hidden" name="client" value="{{ client_id }}">
        <input type="hidden" name="status" value="unpaid">

        {{ form.work_order|as_crispy_field }}

        <div class="mb-3">
          <label for="id_amount" class="form-label">Amount</label>
          <div class="input-group">
            <span class="input-group-text">$</span>
            {{ form.amount }}
          </div>
          {% if creating and work_order.estimated_cost %}
          <small class="form-text text-muted">Pre-filled from work order estimated cost (${{ work_order.estimated_cost }})</small>
          {% endif %}
        </div>

        {{ form.notes|as_crispy_field }}

        <button type="submit" class="btn btn-success">
          {% if creating %}Create Invoice{% else %}Update Invoice{% endif %}
        </button>
      </form>
    </div>
  </div>

  <!-- Navigation Links -->
  <div class="mt-4 text-center">
    {% if creating %}
    <a href="{% url 'completed_jobs' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Completed Jobs</a>
    {% else %}
    <a href="{% url 'invoice_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Invoice Overview</a>
    {% endif %}
    <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const clientSelect = $('#id_client');
  const workOrderSelect = document.getElementById('id_work_order');

  if (clientSelect.length) {
    clientSelect.select2({
      placeholder: 'Search for a client…',
      allowClear: true,
      minimumInputLength: 1,
      ajax: {
        url: "{% url 'ajax_get_clients' %}",
        dataType: 'json',
        delay: 250,
        data: params => ({ q: params.term }),
        processResults: data => ({ results: data })
      }
    });

    clientSelect.on('select2:select', function (e) {
      const clientId = e.params.data.id;

      workOrderSelect.disabled = true;
      workOrderSelect.innerHTML = '<option>Loading...</option>';

      fetch(`/invoices/ajax_get_active_workorders/?client_id=${clientId}`)
        .then(response => response.json())
        .then(data => {
          workOrderSelect.innerHTML = '';

          if (data.length === 0) {
            const opt = document.createElement('option');
            opt.text = 'No completed work orders';
            opt.disabled = true;
            opt.selected = true;
            workOrderSelect.add(opt);
          } else {
            const placeholder = document.createElement('option');
            placeholder.text = 'Select a work order…';
            placeholder.disabled = true;
            placeholder.selected = true;
            workOrderSelect.add(placeholder);

            data.forEach(item => {
              const opt = document.createElement('option');
              opt.value = item.id;
              opt.text = item.text;
              workOrderSelect.add(opt);
            });
          }

          workOrderSelect.disabled = false;
        });
    });
  }
});
</script>
{% endblock %}

===== templates/invoices/invoice_detail.html =====
{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block title %}Invoice Detail{% endblock %}

{% block content %}
<div class="container">

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'invoice_unpaid' %}" class="btn btn-outline-danger w-100 w-sm-auto">Not in QuickBooks</a>
      <a href="{% url 'invoice_in_quickbooks' %}" class="btn btn-outline-warning w-100 w-sm-auto">In QuickBooks</a>
      <a href="{% url 'invoice_paid' %}" class="btn btn-outline-success w-100 w-sm-auto">Paid</a>
    </div>
  </div>

  <!-- Invoice Summary Card -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Invoice #{{ invoice.invoice_number }}</h4>
      <div>
        <a href="{% url 'invoice_update' invoice.id %}" class="btn btn-warning btn-sm me-2">Edit Invoice</a>
        <a href="{% url 'invoice_list' %}" class="btn btn-light btn-sm">Back to Overview</a>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p class="mb-1"><strong>Amount:</strong> ${{ invoice.amount }}</p>
          <p class="mb-1"><strong>Status:</strong> 
            <span class="badge 
              {% if invoice.status == 'unpaid' %}bg-danger
              {% elif invoice.status == 'in_quickbooks' %}bg-warning text-dark
              {% else %}bg-success{% endif %}">
              {{ invoice.get_status_display }}
            </span>
          </p>
        </div>
        <div class="col-md-6">
          <p class="mb-1"><strong>Date Created:</strong> {{ invoice.date_created|date:"M d, Y" }}</p>
          {% if invoice.notes %}
            <p class="mb-1"><strong>Notes:</strong> {{ invoice.notes }}</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Work Order Information (If Available) -->
  {% if invoice.work_order %}
  <div class="card mb-4 bg-light">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">Work Order Information</h5>
    </div>
    <div class="card-body">
      
      <!-- Complete Client Information -->
      <h6>Client Information</h6>
      <div class="row mb-3">
        <div class="col-md-6">
          <p class="mb-1"><strong>Name:</strong> {{ invoice.client.name }}</p>
          <p class="mb-1"><strong>Email:</strong> {{ invoice.client.email|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Phone:</strong> {{ invoice.client.phone|default:"Not provided" }}</p>
        </div>
        <div class="col-md-6">
          <p class="mb-1"><strong>Address:</strong> {{ invoice.client.address|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Billing Address:</strong> 
            {% if invoice.client.billing_address %}
              {{ invoice.client.billing_address }}
            {% else %}
              <em>Not specified</em>
            {% endif %}
          </p>
        </div>
      </div>

      <!-- Work Order Details -->
      <h6>Work Order Details</h6>
      <div class="row mb-3">
        <div class="col-md-6">
          <p class="mb-1"><strong>Work Order ID:</strong> {{ invoice.work_order.id }}</p>
          <p class="mb-1"><strong>Status:</strong> {{ invoice.work_order.get_status_display }}</p>
        </div>
        <div class="col-md-6">
          <p class="mb-1"><strong>Estimated Cost:</strong> ${{ invoice.work_order.estimated_cost }}</p>
        </div>
      </div>
      
      <!-- Job Description -->
      {% if invoice.work_order.job_description %}
      <h6>Job Description</h6>
      <div class="bg-white p-3 rounded border mb-3">
        {{ invoice.work_order.job_description }}
      </div>
      {% endif %}

      <!-- Scheduled Events -->
      {% if events %}
      <h6>Scheduled Events</h6>
      <div class="row">
        {% for event in events %}
        <div class="col-md-6 mb-2">
          <div class="card border">
            <div class="card-body py-2">
              <h6 class="card-title text-primary mb-1">{{ event.get_event_type_display }}</h6>
              <p class="card-text mb-1 small"><strong>Date:</strong> {{ event.date|date:"M d, Y" }}</p>
              <p class="card-text mb-0 small"><strong>Address:</strong> {{ event.address }}</p>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
        <p class="mb-0"><strong>Scheduled Events:</strong> No events scheduled</p>
      {% endif %}
    </div>
  </div>
  {% else %}
  <!-- No Work Order -->
  <div class="card mb-4">
    <div class="card-header bg-secondary text-white">
      <h5 class="mb-0">Client Information</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p class="mb-1"><strong>Name:</strong> {{ invoice.client.name }}</p>
          <p class="mb-1"><strong>Email:</strong> {{ invoice.client.email|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Phone:</strong> {{ invoice.client.phone|default:"Not provided" }}</p>
        </div>
        <div class="col-md-6">
          <p class="mb-1"><strong>Address:</strong> {{ invoice.client.address|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Billing Address:</strong> 
            {% if invoice.client.billing_address %}
              {{ invoice.client.billing_address }}
            {% else %}
              <em>Not specified</em>
            {% endif %}
          </p>
        </div>
      </div>
      <div class="alert alert-info mt-3 mb-0">
        <i class="bi bi-info-circle me-2"></i>This invoice is not linked to a work order.
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Action Buttons -->
  <div class="card">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">Actions</h5>
    </div>
    <div class="card-body">
      <div class="d-flex flex-column flex-sm-row gap-2">
        <button class="btn btn-primary" onclick="window.print();">
          <i class="bi bi-printer me-1"></i>Print Invoice
        </button>
        <a href="{% url 'invoice_update' invoice.id %}" class="btn btn-warning">
          <i class="bi bi-pencil me-1"></i>Edit Invoice
        </a>
        <a href="{% url 'invoice_delete' invoice.id %}" class="btn btn-danger">
          <i class="bi bi-trash me-1"></i>Delete Invoice
        </a>
      </div>
    </div>
  </div>

  <!-- Navigation Links -->
  <div class="mt-4 text-center">
    <a href="{% url 'invoice_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Invoice Overview</a>
    <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>
</div>
{% endblock %}

===== templates/base.html =====
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Art Moving Business Management System{% endblock %}</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="64x64" href="{% static 'images/icon-64x64.png' %}">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'css/custom.css' %}">
  <link href="https://fonts.cdnfonts.com/css/open-dyslexic" rel="stylesheet">

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  {% block extra_css %}{% endblock %}
</head>
<body class="d-flex flex-column min-vh-100">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark py-2">
    <div class="container">
      <a href="{% url 'home' %}" class="d-flex align-items-center text-decoration-none">
        <img src="{% static 'images/nav-icon-128x128.png' %}" alt="Site Icon" class="me-2" style="height:40px;">
        <span class="navbar-brand mb-0 h4">EJ Art Mover</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item"><a class="nav-link px-3" href="{% url 'home' %}"><i class="bi bi-speedometer2 me-1"></i>Dashboard</a></li>
          <li class="nav-item"><a class="nav-link px-3" href="{% url 'workorder_list' %}"><i class="bi bi-card-checklist me-1"></i>Work Orders</a></li>
          <li class="nav-item"><a class="nav-link px-3" href="{% url 'client_list' %}"><i class="bi bi-people-fill me-1"></i>Clients</a></li>
          <li class="nav-item"><a class="nav-link px-3" href="{% url 'invoice_list' %}"><i class="bi bi-receipt me-1"></i>Invoices</a></li>
          {% if user.is_authenticated %}
            <li class="nav-item"><a class="nav-link px-3" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right me-1"></i>Logout</a></li>
          {% else %}
            <li class="nav-item"><a class="nav-link px-3" href="{% url 'login' %}"><i class="bi bi-box-arrow-in-right me-1"></i>Login</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>

  <!-- Offcanvas Sidebar -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
    <div class="offcanvas-header border-bottom">
      <h5 class="offcanvas-title" id="offcanvasSidebarLabel">Navigation</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      {% if user.is_authenticated %}
        <div class="text-center mb-4">
          <i class="bi bi-person-circle fs-1 text-secondary"></i>
          <div class="mt-2 fw-semibold">{{ user.username }}</div>
        </div>
      {% endif %}
      <div class="list-group">
        <h6 class="text-uppercase mb-2">Dashboard</h6>
        <a href="{% url 'home' %}" class="list-group-item list-group-item-action"><i class="bi bi-speedometer2 me-2"></i>Home</a>

        <h6 class="text-uppercase mt-4 mb-2">Work Orders</h6>
        <a href="{% url 'workorder_list' %}" class="list-group-item list-group-item-action"><i class="bi bi-card-checklist me-2"></i>All Jobs</a>
        <a href="{% url 'pending_jobs' %}" class="list-group-item list-group-item-action"><i class="bi bi-hourglass-split me-2"></i>Pending</a>
        <a href="{% url 'scheduled_jobs' %}" class="list-group-item list-group-item-action"><i class="bi bi-calendar-event me-2"></i>Scheduled</a>
        <a href="{% url 'completed_jobs' %}" class="list-group-item list-group-item-action"><i class="bi bi-check-circle me-2"></i>Completed</a>
        <a href="{% url 'workorder_create' %}" class="list-group-item list-group-item-action text-success"><i class="bi bi-plus-circle me-2"></i>New Job</a>

        <h6 class="text-uppercase mt-4 mb-2">Clients</h6>
        <a href="{% url 'client_list' %}" class="list-group-item list-group-item-action"><i class="bi bi-people-fill me-2"></i>All Clients</a>
        <a href="{% url 'client_create' %}" class="list-group-item list-group-item-action text-warning"><i class="bi bi-person-plus me-2"></i>New Client</a>

        <h6 class="text-uppercase mt-4 mb-2">Invoicing</h6>
        <a href="{% url 'invoice_list' %}" class="list-group-item list-group-item-action"><i class="bi bi-receipt me-2"></i>Overview</a>
        <a href="{% url 'invoice_unpaid' %}" class="list-group-item list-group-item-action text-danger"><i class="bi bi-clock me-2"></i>Not In QuickBooks</a>
        <a href="{% url 'invoice_in_quickbooks' %}" class="list-group-item list-group-item-action text-warning"><i class="bi bi-hourglass me-2"></i>In QuickBooks</a>
        <a href="{% url 'invoice_paid' %}" class="list-group-item list-group-item-action text-success"><i class="bi bi-check2-circle me-2"></i>Paid</a>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="container my-4 flex-grow-1">
    {% block content %}{% endblock %}
  </main>

  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
    {% if messages %}
      {% for message in messages %}
        <div class="toast align-items-center text-white bg-success border-0 show" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="d-flex">
            <div class="toast-body">
              {{ message }}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </div>

  <!-- Footer -->
  <footer class="bg-dark text-white text-center py-3 mt-auto">
    <div class="container">
      <small>&copy; {% now "Y" %} Art Moving Business Management System</small>
    </div>
  </footer>

  <!-- JS Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  {% block extra_js %}{% endblock %}
</body>
</html>

===== templates/workorders/workorder_confirm_delete.html =====
{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block title %}Confirm Delete Work Order{% endblock %}
{% block content %}
<div class="container">
  <h2 class="mb-4">Delete Work Order #{{ workorder.id }}</h2>
  <p>Are you sure you want to delete this work order?</p>
  
  <form method="post">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">Yes, delete it</button>
    <a href="{% url 'workorder_detail' workorder.id %}" class="btn btn-secondary">Cancel</a>
  </form>
</div>
{% endblock %}


===== templates/workorders/completed_jobs.html =====
{% extends "base.html" %}
{% block title %}Completed Jobs{% endblock %}
{% block content %}
<div class="container">
  <h2 class="mb-4">Completed Jobs</h2>

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'pending_jobs' %}" class="btn btn-outline-primary w-100">Pending Jobs</a>
      <a href="{% url 'scheduled_jobs' %}" class="btn btn-outline-primary w-100">Scheduled Jobs</a>
      <a href="{% url 'completed_jobs' %}" class="btn btn-outline-primary w-100">Completed Jobs</a>
      <a href="{% url 'workorder_create' %}" class="btn btn-outline-primary w-100">New Work Order</a>
    </div>
  </div>

  <!-- Completed – Not Yet Paid -->
  <div class="card mb-4">
    <div class="card-header bg-warning text-dark">
      <h5 class="mb-0">Completed – Not Yet Paid</h5>
    </div>
    <div class="card-body p-0">
      {% if uninvoiced_jobs %}
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="small">
            <tr>
              <th>ID</th>
              <th>Client</th>
              <th class="d-none d-md-table-cell">Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for job in uninvoiced_jobs %}
            <tr>
              <td>{{ job.id }}</td>
              <td>{{ job.client.name }}</td>
              <td class="d-none d-md-table-cell text-truncate" style="max-width:200px;">{{ job.job_description|truncatewords:10 }}</td>
              <td>
                <div class="d-flex flex-column flex-sm-row gap-2">
                  <a href="{% url 'workorder_detail' job.id %}" class="btn btn-sm btn-info w-100 w-sm-auto">View</a>
                  <a href="{% url 'workorder_edit' job.id %}" class="btn btn-sm btn-warning w-100 w-sm-auto">Edit</a>
                  <a href="/invoices/create/?work_order={{ job.id }}" class="btn btn-sm btn-success w-100 w-sm-auto">📄 Create Invoice</a>
                  <form method="post" action="{% url 'mark_paid' job.id %}" class="w-100">{% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-primary w-100 w-sm-auto">Mark as Paid</button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="p-3 mb-0">No completed jobs awaiting payment.</p>
      {% endif %}
    </div>
  </div>

  <!-- Completed – Paid -->
  <div class="card mb-4">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">Completed – Paid</h5>
    </div>
    <div class="card-body p-0">
      {% if invoiced_jobs %}
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="small">
            <tr>
              <th>ID</th>
              <th>Client</th>
              <th class="d-none d-md-table-cell">Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for job in invoiced_jobs %}
            <tr>
              <td>{{ job.id }}</td>
              <td>{{ job.client.name }}</td>
              <td class="d-none d-md-table-cell text-truncate" style="max-width:200px;">{{ job.job_description|truncatewords:10 }}</td>
              <td>
                <div class="d-flex flex-column flex-sm-row gap-2">
                  <a href="{% url 'workorder_detail' job.id %}" class="btn btn-sm btn-info w-100 w-sm-auto">View</a>
                  <a href="{% url 'workorder_edit' job.id %}" class="btn btn-sm btn-warning w-100 w-sm-auto">Edit</a>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="p-3 mb-0">No paid jobs found.</p>
      {% endif %}
    </div>
  </div>

  <!-- Back Button -->
  <div class="text-center">
    <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>
</div>
{% endblock %}

===== templates/workorders/workorder_pdf.html =====
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Work Order #{{ job.id }}</title>
  <style>
    body { 
      font-family: 'Arial', sans-serif; 
      color: #333; 
      margin: 1rem;
      line-height: 1.4;
    }
    
    .header { 
      text-align: center; 
      margin-bottom: 2rem; 
      border-bottom: 2px solid #007bff;
      padding-bottom: 1rem;
    }
    
    .logo { 
      font-size: 1.5rem; 
      font-weight: bold; 
      margin-bottom: 0.5rem;
    }
    
    .work-order-title {
      font-size: 1.8rem;
      margin: 0;
      color: #007bff;
    }
    
    .section { 
      margin-bottom: 1.5rem; 
      break-inside: avoid;
    }
    
    .section-title { 
      background-color: #f8f9fa;
      border-left: 4px solid #007bff;
      padding: 0.5rem 1rem;
      margin-bottom: 1rem; 
      font-size: 1.1rem;
      font-weight: bold;
      color: #495057;
    }
    
    .info-row {
      display: flex;
      margin-bottom: 0.5rem;
    }
    
    .info-label { 
      font-weight: bold; 
      width: 150px; 
      display: inline-block;
      color: #495057;
    }
    
    .info-value {
      flex: 1;
    }
    
    .status-badge {
      background-color: #28a745;
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      display: inline-block;
    }
    
    .event-item {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 0.25rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
    }
    
    .event-type {
      font-weight: bold;
      color: #007bff;
      margin-bottom: 0.25rem;
    }
    
    .event-details {
      font-size: 0.9rem;
      color: #6c757d;
    }
    
    .note-item {
      background-color: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 0.25rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
    }
    
    .note-text {
      margin-bottom: 0.25rem;
    }
    
    .note-date {
      font-size: 0.8rem;
      color: #6c757d;
      font-style: italic;
    }
    
    .two-column {
      display: flex;
      gap: 2rem;
    }
    
    .column {
      flex: 1;
    }
    
    .footer {
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px solid #dee2e6;
      text-align: center;
      font-size: 0.9rem;
      color: #6c757d;
    }
    
    @media print {
      body { margin: 0; }
      .section { break-inside: avoid; }
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo">EJ Art Moving</div>
    <h1 class="work-order-title">Work Order #{{ job.id }}</h1>
  </div>

  <!-- Client Information -->
  <div class="section">
    <div class="section-title">Client Information</div>
    <div class="two-column">
      <div class="column">
        <div class="info-row">
          <span class="info-label">Name:</span>
          <span class="info-value">{{ job.client.name }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Email:</span>
          <span class="info-value">{{ job.client.email|default:"Not provided" }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Phone:</span>
          <span class="info-value">{{ job.client.phone|default:"Not provided" }}</span>
        </div>
      </div>
      <div class="column">
        <div class="info-row">
          <span class="info-label">Service Address:</span>
          <span class="info-value">{{ job.client.address|default:"Not provided" }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Billing Address:</span>
          <span class="info-value">{{ job.client.billing_address|default:"Not provided" }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Work Order Details -->
  <div class="section">
    <div class="section-title">Work Order Details</div>
    <div class="two-column">
      <div class="column">
        <div class="info-row">
          <span class="info-label">Job Description:</span>
          <span class="info-value">{{ job.job_description|default:"No description provided" }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Estimated Cost:</span>
          <span class="info-value">${{ job.estimated_cost|default:"0.00" }}</span>
        </div>
      </div>
      <div class="column">
        <div class="info-row">
          <span class="info-label">Status:</span>
          <span class="info-value">
            <span class="status-badge">{{ job.get_status_display }}</span>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Created:</span>
          <span class="info-value">{{ job.created_at|date:"F j, Y g:i A" }}</span>
        </div>
        {% if job.completed_at %}
        <div class="info-row">
          <span class="info-label">Completed:</span>
          <span class="info-value">{{ job.completed_at|date:"F j, Y g:i A" }}</span>
        </div>
        {% endif %}
        {% if job.invoiced %}
        <div class="info-row">
          <span class="info-label">Invoiced:</span>
          <span class="info-value">Yes</span>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Scheduled Events -->
  <div class="section">
    <div class="section-title">Scheduled Events</div>
    {% if job.events.all %}
      {% for event in job.events.all %}
        <div class="event-item">
          <div class="event-type">{{ event.get_event_type_display }}</div>
          <div class="event-details">
            {% if event.address %}
              <strong>Address:</strong> {{ event.address }}<br>
            {% endif %}
            {% if event.date %}
              <strong>Date:</strong> {{ event.date|date:"F j, Y" }}
            {% else %}
              <strong>Date:</strong> To be scheduled
            {% endif %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p style="font-style: italic; color: #6c757d;">No scheduled events.</p>
    {% endif %}
  </div>

  <!-- Notes -->
  <div class="section">
    <div class="section-title">Notes</div>
    {% if job.notes.all %}
      {% for note in job.notes.all %}
        <div class="note-item">
          <div class="note-text">{{ note.note }}</div>
          <div class="note-date">Added: {{ note.created_at|date:"F j, Y g:i A" }}</div>
        </div>
      {% endfor %}
    {% else %}
      <p style="font-style: italic; color: #6c757d;">No notes available.</p>
    {% endif %}
  </div>

  <!-- Attachments -->
  {% if job.attachments.all %}
  <div class="section">
    <div class="section-title">Attachments</div>
    {% for attachment in job.attachments.all %}
      {% if attachment.file %}
        <div class="info-row">
          <span class="info-label">File:</span>
          <span class="info-value">{{ attachment.file.name }} ({{ attachment.uploaded_at|date:"F j, Y" }})</span>
        </div>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}

  <div class="footer">
    <p>Generated on {{ "now"|date:"F j, Y g:i A" }} | EJ Art Moving Business Management System</p>
  </div>

</body>
</html>

===== templates/workorders/workorder_detail.html =====
{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Work Order Detail{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Client Information - MOVED TO TOP -->
  <div class="card mb-4">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">Client Information</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p class="mb-1"><strong>Name:</strong> {{ job.client.name }}</p>
          <p class="mb-1"><strong>Email:</strong> {{ job.client.email|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Phone:</strong> {{ job.client.phone|default:"Not provided" }}</p>
        </div>
        <div class="col-md-6">
          <p class="mb-1"><strong>Service Address:</strong> {{ job.client.address|default:"Not provided" }}</p>
          <p class="mb-1"><strong>Billing Address:</strong> 
            {% if job.client.billing_address %}
              {{ job.client.billing_address }}
            {% else %}
              <em>Not provided</em>
            {% endif %}
          </p>
        </div>
      </div>
      <div class="mt-3">
        <a href="{% url 'client_detail' job.client.id %}" class="btn btn-sm btn-outline-info">
          <i class="bi bi-person-circle me-1"></i>View Full Client Profile
        </a>
        <a href="{% url 'client_edit' job.client.id %}" class="btn btn-sm btn-outline-warning">
          <i class="bi bi-pencil me-1"></i>Edit Client Info
        </a>
      </div>
    </div>
  </div>

  <!-- Work Order Summary -->
  <div class="card mb-4">
    <div class="card-header bg-secondary text-white">
      <h5 class="mb-0">Work Order #{{ job.id }}</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p><strong>Job Description:</strong> {{ job.job_description }}</p>
          <p><strong>Estimated Cost:</strong> ${{ job.estimated_cost }}</p>
        </div>
        <div class="col-md-6">
          <p><strong>Status:</strong> 
            <span class="badge 
              {% if job.status == 'pending' %}bg-secondary
              {% elif job.status == 'in_progress' %}bg-info
              {% elif job.status == 'completed' %}bg-success
              {% endif %}">
              {{ job.get_status_display }}
            </span>
          </p>
          <p><strong>Created At:</strong> {{ job.created_at|date:"M d, Y g:i A" }}</p>
          {% if job.completed_at %}
            <p><strong>Completed At:</strong> {{ job.completed_at|date:"M d, Y g:i A" }}</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Status Progression Action Bar -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Actions - Next Steps</h5>
    </div>
    <div class="card-body">
      {% if job.status == 'pending' or job.status == 'in_progress' %}
        {% if job.status == 'pending' %}
          <div class="alert alert-info mb-3">
            <i class="bi bi-info-circle me-2"></i>
            <strong>Status: Pending</strong> - This job needs to be scheduled or marked as completed.
          </div>
        {% else %}
          <div class="alert alert-info mb-3">
            <i class="bi bi-calendar-event me-2"></i>
            <strong>Status: Scheduled</strong> - This job has scheduled events and is ready to be completed.
          </div>
        {% endif %}
        
        <div class="d-flex flex-column flex-lg-row gap-2">
          <a href="{% url 'workorder_edit' job.id %}" class="btn btn-warning">
            <i class="bi bi-pencil me-1"></i>
            {% if job.status == 'pending' %}Schedule Events{% else %}Edit Schedule{% endif %}
          </a>
          <form method="post" action="{% url 'mark_completed' job.id %}" class="flex-fill">
            {% csrf_token %}
            <button type="submit" class="btn btn-success w-100">
              <i class="bi bi-check-circle me-1"></i>Mark Completed
            </button>
          </form>
          <form method="post" action="{% url 'complete_and_invoice' job.id %}" class="flex-fill">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary w-100">
              <i class="bi bi-receipt me-1"></i>Complete & Create Invoice
            </button>
          </form>
          <form method="post" action="{% url 'mark_completed_and_paid' job.id %}" class="flex-fill">
            {% csrf_token %}
            <button type="submit" class="btn btn-dark w-100">
              <i class="bi bi-cash me-1"></i>Complete & Mark Paid
            </button>
          </form>
        </div>
      
      {% elif job.status == 'completed' %}
        {% if not job.invoiced %}
          <div class="alert alert-warning mb-3">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>Status: Completed - Not Yet Paid</strong> - Ready to create invoice or mark as paid.
          </div>
          
          <div class="d-flex flex-column flex-lg-row gap-2">
            <a href="/invoices/create/?work_order={{ job.id }}" class="btn btn-success">
              <i class="bi bi-receipt me-1"></i>Create Invoice
            </a>
            <form method="post" action="{% url 'mark_paid' job.id %}" class="flex-fill">
              {% csrf_token %}
              <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-cash me-1"></i>Mark as Paid (No Invoice)
              </button>
            </form>
          </div>
        {% else %}
          <div class="alert alert-success mb-3">
            <i class="bi bi-check-circle me-2"></i>
            <strong>Status: Completed & Paid</strong> - This job is finished and has been invoiced/paid.
          </div>
          
          <div class="d-flex flex-column flex-lg-row gap-2">
            {% if job.invoices.exists %}
              <a href="{% url 'invoice_detail' job.invoices.first.id %}" class="btn btn-outline-success">
                <i class="bi bi-receipt me-1"></i>View Invoice
              </a>
            {% endif %}
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <!-- Scheduled Events -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Scheduled Events</h5>
    </div>
    <div class="card-body">
      <ul class="list-group">
        {% for event in events %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <strong>{{ event.get_event_type_display }}:</strong> 
              {{ event.address }}
            </div>
            <span class="badge bg-primary">{{ event.date|date:"M d, Y" }}</span>
          </li>
        {% empty %}
          <li class="list-group-item">No scheduled events.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Attachments & Notes -->
  <div class="row">
    <!-- Attachments -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">Attachments</h5>
        </div>
        <div class="card-body">
          <ul class="list-group">
            {% for attachment in attachments %}
              <li class="list-group-item">
                <a href="{{ attachment.file.url }}">{{ attachment.file.name }}</a>
                <small class="text-muted d-block">{{ attachment.uploaded_at|date:"M d, Y g:i A" }}</small>
              </li>
            {% empty %}
              <li class="list-group-item">No attachments.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Notes -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0">Notes</h5>
        </div>
        <div class="card-body">
          <ul class="list-group">
            {% for note in notes %}
              <li class="list-group-item">
                {{ note.note }}
                <small class="text-muted d-block">{{ note.created_at|date:"M d, Y g:i A" }}</small>
              </li>
            {% empty %}
              <li class="list-group-item">No notes.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Management Action Buttons -->
  <div class="mt-4 d-flex flex-column flex-sm-row justify-content-between gap-2">
    <a href="{% url 'workorder_edit' job.id %}" class="btn btn-outline-primary w-100 w-sm-auto">
      <i class="bi bi-pencil me-1"></i>Edit Work Order
    </a>
    <a href="{% url 'workorder_pdf' job.id %}" class="btn btn-light border d-flex align-items-center gap-2 shadow-sm px-4 py-2 w-100 w-sm-auto" target="_blank" style="border-color: #999;">
      <i class="bi bi-printer-fill text-primary fs-5"></i>
      <span class="fw-semibold text-dark">Print Work Order</span>
    </a>
    <a href="{% url 'workorder_delete' job.id %}" class="btn btn-outline-danger w-100 w-sm-auto">
      <i class="bi bi-trash me-1"></i>Delete Work Order
    </a>
  </div>

  <!-- Navigation Buttons -->
  <div class="text-center mt-4">
    <a href="{% url 'workorder_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Work Orders</a>
    <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<!-- Optional JS for future interactivity -->
{% endblock %}

===== templates/workorders/workorder_form.html =====
{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block title %}{{ job|default_if_none:"New" }} Work Order{% endblock %}

{% block extra_css %}
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
  <style>
    @media (max-width: 768px) {
      .d-flex.flex-column.flex-lg-row .btn {
        margin-bottom: 0.5rem;
        min-height: 48px;
      }
      .modal-dialog {
        margin: 0.5rem;
      }
      .form-control, .form-select {
        min-height: 44px;
        font-size: 16px;
      }
    }
    /* Hide the formset - we'll use modal instead */
    #event-forms-container {
      display: none;
    }
    #add-event {
      display: none;
    }
    #empty-form-template {
      display: none;
    }
  </style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- Top Nav Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'pending_jobs' %}" class="btn btn-outline-primary">Pending Jobs</a>
      <a href="{% url 'scheduled_jobs' %}" class="btn btn-outline-primary">Scheduled Jobs</a>
      <a href="{% url 'completed_jobs' %}" class="btn btn-outline-primary">Completed Jobs</a>
      <a href="{% url 'workorder_create' %}" class="btn btn-outline-primary">New Work Order</a>
    </div>
  </div>

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Client & Job Details -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        <h5 class="mb-0">Client &amp; Job Details</h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <!-- Client picker -->
          <div class="col-md-6">
            {{ form.client|as_crispy_field }}
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" data-bs-toggle="modal" data-bs-target="#newClientModal">
              + Add New Client
            </button>
          </div>

          <!-- Job description -->
          <div class="col-md-6">
            {{ form.job_description|as_crispy_field }}
          </div>

          <!-- Estimated cost -->
          <div class="col-md-6">
            <label class="form-label fw-bold">Estimated Cost</label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              {{ form.estimated_cost }}
            </div>
          </div>

          <!-- Invoiced checkbox - properly displayed -->
          {% if job %}
          <div class="col-md-6 d-flex align-items-center">
            <div class="form-check">
              {{ form.invoiced }}
              <label class="form-check-label ms-2" for="{{ form.invoiced.id_for_label }}">
                Mark as Invoiced
              </label>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Scheduled Events -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Scheduled Events</h5>
        <button type="button" class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#eventModal">
          <i class="bi bi-plus me-1"></i>Add Event
        </button>
      </div>
      <div class="card-body">
        <!-- Display existing events nicely -->
        <div id="events-display">
          {% if job.events.all %}
            {% for event in job.events.all %}
              <div class="alert alert-info d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ event.get_event_type_display }}</strong><br>
                  <small>{{ event.address }} • {{ event.date|date:"M d, Y" }}</small>
                </div>
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="editEvent({{ event.id }})">
                  <i class="bi bi-pencil"></i>
                </button>
              </div>
            {% endfor %}
          {% else %}
            <div class="text-center text-muted py-4">
              <i class="bi bi-calendar-x fs-1 mb-2 d-block"></i>
              No events scheduled yet. Click "Add Event" to get started.
            </div>
          {% endif %}
        </div>
        
        <!-- Hidden formset (for backend compatibility) -->
        <div style="display: none;">
          {{ event_formset.management_form }}
          <div id="event-forms-container">
            {% for subform in event_formset %}
              <div class="event-form">{{ subform|crispy }}</div>
            {% endfor %}
          </div>
          <div id="empty-form-template">
            {{ event_formset.empty_form|crispy }}
          </div>
        </div>
      </div>
    </div>

    <!-- Attachments -->
    <div class="card mb-4">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0">Attachments</h5>
      </div>
      <div class="card-body">
        {{ attachment_form|crispy }}
      </div>
    </div>

    <!-- Notes -->
    <div class="card mb-4">
      <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">Notes</h5>
      </div>
      <div class="card-body">
        {{ note_form|crispy }}
      </div>
    </div>

    <!-- Submit Buttons -->
    <div class="d-flex flex-column flex-lg-row justify-content-end gap-2 mb-4">
      <button type="submit" name="save_only" class="btn btn-success">
        <i class="bi bi-check me-1"></i>
        {% if job %}Update Work Order{% else %}Save Work Order{% endif %}
      </button>
      <button type="submit" name="save_and_invoice" class="btn btn-primary">
        <i class="bi bi-receipt me-1"></i>
        {% if job %}Update & Create Invoice{% else %}Save & Create Invoice{% endif %}
      </button>
      <button type="submit" name="save_and_complete" class="btn btn-warning">
        <i class="bi bi-check-square me-1"></i>
        {% if job %}Update & Mark Complete{% else %}Save & Mark Complete{% endif %}
      </button>
    </div>
    <div class="text-center mb-4">
      <small class="text-muted">
        <i class="bi bi-info-circle me-1"></i>
        Choose: Save to continue later, Create Invoice to bill, or Mark Complete if finished
      </small>
    </div>
  </form>

  <!-- Bottom Navigation Buttons -->
  <div class="text-center">
    <a href="{% url 'workorder_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Work Orders</a>
    <a href="{% url 'home' %}" class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>
</div>

<!-- New Client Modal -->
<div class="modal fade" id="newClientModal" tabindex="-1" aria-labelledby="newClientModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="newClientModalLabel">Add New Client</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="newClientForm">
          {% csrf_token %}
          <div class="mb-3">
            <label for="newClientName" class="form-label">Name *</label>
            <input type="text" class="form-control" id="newClientName" name="name" required>
          </div>
          <div class="mb-3">
            <label for="newClientEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="newClientEmail" name="email">
          </div>
          <div class="mb-3">
            <label for="newClientPhone" class="form-label">Phone</label>
            <input type="text" class="form-control" id="newClientPhone" name="phone">
          </div>
          <div class="mb-3">
            <label for="newClientAddress" class="form-label">Address</label>
            <input type="text" class="form-control" id="newClientAddress" name="address">
          </div>
          <div class="mb-3">
            <label for="newClientBillingAddress" class="form-label">Billing Address</label>
            <input type="text" class="form-control" id="newClientBillingAddress" name="billing_address">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="saveNewClient">Save Client</button>
      </div>
    </div>
  </div>
</div>

<!-- Event Modal -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="eventModalLabel">
          <i class="bi bi-calendar-plus me-2"></i>Add Event
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="eventForm">
          <div class="mb-3">
            <label for="eventType" class="form-label">Event Type *</label>
            <select class="form-select" id="eventType" required>
              <option value="">Select event type...</option>
              <option value="pickup">Pickup</option>
              <option value="pickup_wrap">Pickup and Wrap</option>
              <option value="wrap">Wrap</option>
              <option value="install">Install</option>
              <option value="deliver_install">Deliver and Install</option>
              <option value="dropoff">Drop Off</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="eventAddress" class="form-label">Address</label>
            <input type="text" class="form-control" id="eventAddress">
          </div>
          <div class="mb-3">
            <label for="eventDate" class="form-label">Date</label>
            <input type="date" class="form-control" id="eventDate">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="saveEvent">Add Event</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
let eventCounter = 0;

$(document).ready(function() {
  $('.select2').select2({ width: '100%' });

  // New Client Modal
  $('#saveNewClient').click(function() {
    const formData = {
      'name': $('#newClientName').val(),
      'email': $('#newClientEmail').val(),
      'phone': $('#newClientPhone').val(),
      'address': $('#newClientAddress').val(),
      'billing_address': $('#newClientBillingAddress').val(),
      'csrfmiddlewaretoken': $('[name=csrfmiddlewaretoken]').val()
    };

    if (!formData.name.trim()) {
      alert('Client name is required');
      return;
    }

    $.ajax({
      url: '{% url "client_create_ajax" %}',
      type: 'POST',
      data: formData,
      success: function(response) {
        if (response.success) {
          const clientSelect = $('#id_client');
          const newOption = new Option(response.client.name, response.client.id, false, true);
          clientSelect.append(newOption).trigger('change');
          
          $('#newClientModal').modal('hide');
          $('#newClientForm')[0].reset();
          alert('Client created successfully!');
        } else {
          alert('Error creating client: ' + (response.error || 'Unknown error'));
        }
      },
      error: function() {
        alert('Error creating client. Please try again.');
      }
    });
  });

  // Event Modal
  $('#saveEvent').click(function() {
    const eventType = $('#eventType').val();
    const address = $('#eventAddress').val();
    const date = $('#eventDate').val();

    if (!eventType) {
      alert('Event type is required');
      return;
    }

    // Add to visual display
    const eventTypeText = $('#eventType option:selected').text();
    const eventHtml = `
      <div class="alert alert-info d-flex justify-content-between align-items-center" data-temp-id="${eventCounter}">
        <div>
          <strong>${eventTypeText}</strong><br>
          <small>${address} ${date ? '• ' + new Date(date).toLocaleDateString() : ''}</small>
        </div>
        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="removeEvent(${eventCounter})">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    `;

    $('#events-display .text-center').hide();
    $('#events-display').append(eventHtml);

    // Add hidden form fields for submission
    const formContainer = $('#event-forms-container');
    const formCount = formContainer.children('.event-form').length;
    
    const hiddenForm = `
      <div class="event-form" data-temp-id="${eventCounter}">
        <input type="hidden" name="events-${formCount}-event_type" value="${eventType}">
        <input type="hidden" name="events-${formCount}-address" value="${address}">
        <input type="hidden" name="events-${formCount}-date" value="${date}">
      </div>
    `;
    
    formContainer.append(hiddenForm);
    
    // Update form count
    $('#id_events-TOTAL_FORMS').val(formCount + 1);

    // Clear and close modal
    $('#eventForm')[0].reset();
    $('#eventModal').modal('hide');
    eventCounter++;
  });

  // Reset modals
  $('#newClientModal, #eventModal').on('hidden.bs.modal', function() {
    $(this).find('form')[0].reset();
  });
});

function removeEvent(tempId) {
  $(`[data-temp-id="${tempId}"]`).remove();
  
  // Update form count
  const formCount = $('#event-forms-container .event-form').length;
  $('#id_events-TOTAL_FORMS').val(formCount);
  
  // Show empty message if no events
  if (formCount === 0) {
    $('#events-display').html(`
      <div class="text-center text-muted py-4">
        <i class="bi bi-calendar-x fs-1 mb-2 d-block"></i>
        No events scheduled yet. Click "Add Event" to get started.
      </div>
    `);
  }
}
</script>
{% endblock %}

===== templates/workorders/scheduled_jobs.html =====
{% extends "base.html" %}
{% block title %}Scheduled Jobs{% endblock %}
{% block content %}
<div class="container">
  <h2 class="mb-4">Scheduled Jobs</h2>
  
  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'pending_jobs' %}"     class="btn btn-outline-primary w-100 w-sm-auto">Pending Jobs</a>
      <a href="{% url 'scheduled_jobs' %}"   class="btn btn-outline-primary w-100 w-sm-auto">Scheduled Jobs</a>
      <a href="{% url 'completed_jobs' %}"   class="btn btn-outline-primary w-100 w-sm-auto">Completed Jobs</a>
      <a href="{% url 'workorder_create' %}" class="btn btn-outline-primary w-100 w-sm-auto">New Work Order</a>
    </div>
  </div>
  
  <!-- Search Bar -->
  <form method="get" class="mb-4">
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Search by client name…" value="{{ query }}">
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
  </form>
  
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">Scheduled Jobs</h5>
    </div>
    <div class="card-body p-0">
      {% if jobs %}
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="small">
            <tr>
              <th>ID</th>
              <th>Client</th>
              <th class="d-none d-md-table-cell">Description</th>
              <th class="d-none d-md-table-cell">Next Event</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for job in jobs %}
            <tr>
              <td>{{ job.id }}</td>
              <td>{{ job.client.name }}</td>
              <td class="d-none d-md-table-cell text-truncate" style="max-width:200px;">
                {{ job.job_description|truncatewords:10 }}
              </td>
              <td class="d-none d-md-table-cell">
                {% with job.events.all|first as next_event %}
                  {% if next_event.date %}{{ next_event.date|date:"m/d/y" }}{% else %}-{% endif %}
                {% endwith %}
              </td>
              <td>
                <div class="d-flex flex-column flex-sm-row gap-2">
                  <a href="{% url 'workorder_detail' job.id %}" class="btn btn-sm btn-info w-100 w-sm-auto">View</a>
                  <a href="{% url 'workorder_edit' job.id %}" class="btn btn-sm btn-warning w-100 w-sm-auto">Edit</a>
                  <form method="post" action="{% url 'mark_completed' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-success w-100">Complete</button>
                  </form>
                  <form method="post" action="{% url 'complete_and_invoice' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-primary w-100">Complete & Invoice</button>
                  </form>
                  <form method="post" action="{% url 'mark_completed_and_paid' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-dark w-100">Complete & Paid</button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="p-3 mb-0">No scheduled jobs found.</p>
      {% endif %}
    </div>
  </div>
  
  <!-- Back Buttons -->
  <div class="text-center">
    <a href="{% url 'workorder_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Work Orders</a>
    <a href="{% url 'home' %}"             class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>
</div>
{% endblock %}

===== templates/workorders/pending_jobs.html =====
{% extends "base.html" %}
{% block title %}Pending Jobs{% endblock %}
{% block content %}
<div class="container">
  <h2 class="mb-4">Pending Jobs</h2>

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'pending_jobs' %}"     class="btn btn-outline-primary w-100 w-sm-auto">Pending Jobs</a>
      <a href="{% url 'scheduled_jobs' %}"   class="btn btn-outline-primary w-100 w-sm-auto">Scheduled Jobs</a>
      <a href="{% url 'completed_jobs' %}"   class="btn btn-outline-primary w-100 w-sm-auto">Completed Jobs</a>
      <a href="{% url 'workorder_create' %}" class="btn btn-outline-primary w-100 w-sm-auto">New Work Order</a>
    </div>
  </div>

  <!-- Search Bar -->
  <form method="get" class="mb-4">
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Search by client name…" value="{{ query }}">
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
  </form>

  <div class="card shadow-sm mb-4">
    <div class="card-header bg-secondary text-white">
      <h5 class="mb-0">Pending Jobs</h5>
    </div>
    <div class="card-body p-0">
      {% if jobs %}
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="small">
            <tr>
              <th>ID</th>
              <th>Client</th>
              <th class="d-none d-md-table-cell">Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for job in jobs %}
            <tr>
              <td>{{ job.id }}</td>
              <td>{{ job.client.name }}</td>
              <td class="d-none d-md-table-cell text-truncate" style="max-width:200px;">
                {{ job.job_description|truncatewords:10 }}
              </td>
              <td>
                <div class="d-flex flex-column flex-sm-row gap-2">
                  <a href="{% url 'workorder_detail' job.id %}" class="btn btn-sm btn-info w-100 w-sm-auto">View</a>
                  <a href="{% url 'workorder_edit' job.id %}" class="btn btn-sm btn-warning w-100 w-sm-auto">Schedule</a>
                  <form method="post" action="{% url 'mark_completed' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-success w-100">Complete</button>
                  </form>
                  <form method="post" action="{% url 'complete_and_invoice' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-primary w-100">Complete & Invoice</button>
                  </form>
                  <form method="post" action="{% url 'mark_completed_and_paid' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-dark w-100">Complete & Paid</button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="p-3 mb-0">No pending jobs found.</p>
      {% endif %}
    </div>
  </div>

  <!-- Back Buttons -->
  <div class="text-center">
    <a href="{% url 'workorder_list' %}" class="btn btn-secondary w-100 w-sm-auto mb-2">Back to Work Orders</a>
    <a href="{% url 'home' %}"             class="btn btn-secondary w-100 w-sm-auto">Back to Dashboard</a>
  </div>
</div>
{% endblock %}

===== templates/workorders/workorder_list.html =====
{% extends "base.html" %}
{% block title %}Work Orders{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">Work Orders</h2>

  <!-- Navigation Buttons -->
  <div class="mb-4 text-center">
    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
      <a href="{% url 'pending_jobs' %}" class="btn btn-outline-primary w-100">Pending Jobs</a>
      <a href="{% url 'scheduled_jobs' %}" class="btn btn-outline-primary w-100">Scheduled Jobs</a>
      <a href="{% url 'completed_jobs' %}" class="btn btn-outline-primary w-100">Completed Jobs</a>
      <a href="{% url 'workorder_create' %}" class="btn btn-outline-primary w-100">New Work Order</a>
    </div>
  </div>

  <!-- Pending Jobs -->
  <div class="card mb-4">
    <div class="card-header bg-secondary text-white position-relative">
      <h5 class="mb-0">
        <a href="{% url 'pending_jobs' %}" class="stretched-link text-white text-decoration-none">Pending Jobs</a>
      </h5>
    </div>
    <div class="card-body p-0">
      {% if pending_jobs %}
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="small"><tr><th>ID</th><th>Client</th><th class="d-none d-md-table-cell">Description</th><th>Actions</th></tr></thead>
          <tbody>
            {% for job in pending_jobs %}
            <tr>
              <td>{{ job.id }}</td>
              <td>{{ job.client.name }}</td>
              <td class="d-none d-md-table-cell text-truncate" style="max-width:200px;">{{ job.job_description|truncatewords:10 }}</td>
              <td>
                <div class="d-flex flex-column flex-sm-row gap-2">
                  <a href="{% url 'workorder_detail' job.id %}" class="btn btn-sm btn-info w-100 w-sm-auto">View</a>
                  <a href="{% url 'workorder_edit' job.id %}" class="btn btn-sm btn-warning w-100 w-sm-auto">Schedule</a>
                  <form method="post" action="{% url 'mark_completed' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-success w-100">Complete</button>
                  </form>
                  <form method="post" action="{% url 'complete_and_invoice' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-primary w-100">Complete & Invoice</button>
                  </form>
                  <form method="post" action="{% url 'mark_completed_and_paid' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-dark w-100">Complete & Paid</button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p class="p-3 mb-0">No pending jobs found.</p>{% endif %}
    </div>
  </div>

  <!-- Scheduled Jobs -->
  <div class="card mb-4">
    <div class="card-header bg-info text-white position-relative">
      <h5 class="mb-0">
        <a href="{% url 'scheduled_jobs' %}" class="stretched-link text-white text-decoration-none">Scheduled Jobs</a>
      </h5>
    </div>
    <div class="card-body p-0">
      {% if scheduled_jobs %}
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="small"><tr><th>ID</th><th>Client</th><th class="d-none d-md-table-cell">Description</th><th>Actions</th></tr></thead>
          <tbody>
            {% for job in scheduled_jobs %}
            <tr>
              <td>{{ job.id }}</td>
              <td>{{ job.client.name }}</td>
              <td class="d-none d-md-table-cell text-truncate" style="max-width:200px;">{{ job.job_description|truncatewords:10 }}</td>
              <td>
                <div class="d-flex flex-column flex-sm-row gap-2">
                  <a href="{% url 'workorder_detail' job.id %}" class="btn btn-sm btn-info w-100 w-sm-auto">View</a>
                  <a href="{% url 'workorder_edit' job.id %}" class="btn btn-sm btn-warning w-100 w-sm-auto">Edit</a>
                  <form method="post" action="{% url 'mark_completed' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-success w-100">Complete</button>
                  </form>
                  <form method="post" action="{% url 'complete_and_invoice' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-primary w-100">Complete & Invoice</button>
                  </form>
                  <form method="post" action="{% url 'mark_completed_and_paid' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-dark w-100">Complete & Paid</button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p class="p-3 mb-0">No scheduled jobs found.</p>{% endif %}
    </div>
  </div>

  <!-- Completed – Not Yet Paid -->
  <div class="card mb-4">
    <div class="card-header bg-warning text-dark position-relative">
      <h5 class="mb-0">
        <a href="{% url 'completed_jobs' %}" class="stretched-link text-dark text-decoration-none">Completed – Not Yet Paid</a>
      </h5>
    </div>
    <div class="card-body p-0">
      {% if completed_uninvoiced_jobs %}
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="small"><tr><th>ID</th><th>Client</th><th class="d-none d-md-table-cell">Description</th><th>Actions</th></tr></thead>
          <tbody>
            {% for job in completed_uninvoiced_jobs %}
            <tr>
              <td>{{ job.id }}</td>
              <td>{{ job.client.name }}</td>
              <td class="d-none d-md-table-cell text-truncate" style="max-width:200px;">{{ job.job_description|truncatewords:10 }}</td>
              <td>
                <div class="d-flex flex-column flex-sm-row gap-2">
                  <a href="{% url 'workorder_detail' job.id %}" class="btn btn-sm btn-info w-100 w-sm-auto">View</a>
                  <a href="{% url 'workorder_edit' job.id %}" class="btn btn-sm btn-warning w-100 w-sm-auto">Edit</a>
                  <a href="/invoices/create/?work_order={{ job.id }}" class="btn btn-sm btn-success w-100 w-sm-auto">📄 Create Invoice</a>
                  <form method="post" action="{% url 'mark_paid' job.id %}" class="w-100 w-sm-auto">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-primary w-100">Mark as Paid</button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p class="p-3 mb-0">No completed jobs awaiting payment.</p>{% endif %}
    </div>
  </div>

  <!-- Completed – Paid -->
  <div class="card mb-4">
    <div class="card-header bg-success text-white position-relative">
      <h5 class="mb-0">
        <a href="{% url 'completed_jobs' %}" class="stretched-link text-white text-decoration-none">Completed – Paid</a>
      </h5>
    </div>
    <div class="card-body p-0">
      {% if completed_invoiced_jobs %}
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="small"><tr><th>ID</th><th>Client</th><th class="d-none d-md-table-cell">Description</th><th>Actions</th></tr></thead>
          <tbody>
            {% for job in completed_invoiced_jobs %}
            <tr>
              <td>{{ job.id }}</td>
              <td>{{ job.client.name }}</td>
              <td class="d-none d-md-table-cell text-truncate" style="max-width:200px;">{{ job.job_description|truncatewords:10 }}</td>
              <td>
                <div class="d-flex flex-column flex-sm-row gap-2">
                  <a href="{% url 'workorder_detail' job.id %}" class="btn btn-sm btn-info w-100 w-sm-auto">View</a>
                  <a href="{% url 'workorder_edit' job.id %}" class="btn btn-sm btn-warning w-100 w-sm-auto">Edit</a>
                  {% if job.invoices.exists %}
                    <a href="{% url 'invoice_detail' job.invoices.first.id %}" class="btn btn-sm btn-outline-success w-100 w-sm-auto">View Invoice</a>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p class="p-3 mb-0">No paid jobs found.</p>{% endif %}
    </div>
  </div>

  <!-- Back to Dashboard -->
  <div class="text-center">
    <a href="{% url 'home' %}" class="btn btn-secondary w-100">Back to Dashboard</a>
  </div>
</div>
{% endblock %}