{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Work Order Detail{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Work Order Summary -->
  <div class="card mb-4">
    <div class="card-header bg-secondary text-white">
      <h5 class="mb-0">Work Order Details</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p><strong>Client:</strong> {{ job.client.name }}</p>
          <p><strong>Job Description:</strong> {{ job.job_description }}</p>
        </div>
        <div class="col-md-6">
          <p><strong>Estimated Cost:</strong> ${{ job.estimated_cost }}</p>
          <p><strong>Status:</strong> {{ job.get_status_display }}</p>
          <p><strong>Created At:</strong> {{ job.created_at|date:"M d, Y g:i A" }}</p>
          {% if job.completed_at %}
            <p><strong>Completed At:</strong> {{ job.completed_at|date:"M d, Y g:i A" }}</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Scheduled Events -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Scheduled Events</h5>
    </div>
    <div class="card-body">
      <ul class="list-group">
        {% for event in events %}
          <li class="list-group-item">
            <strong>{{ event.get_event_type_display }}:</strong> 
            {{ event.address }} on {{ event.date|date:"M d, Y" }}
          </li>
        {% empty %}
          <li class="list-group-item">No scheduled events.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Attachments & Notes -->
  <div class="row">
    <!-- Attachments -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">Attachments</h5>
        </div>
        <div class="card-body">
          <ul class="list-group">
            {% for attachment in attachments %}
              <li class="list-group-item">
                <a href="{{ attachment.file.url }}">{{ attachment.file.name }}</a>
                <small class="text-muted d-block">{{ attachment.uploaded_at|date:"M d, Y g:i A" }}</small>
              </li>
            {% empty %}
              <li class="list-group-item">No attachments.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Notes -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0">Notes</h5>
        </div>
        <div class="card-body">
          <ul class="list-group">
            {% for note in notes %}
              <li class="list-group-item">
                {{ note.note }}
                <small class="text-muted d-block">{{ note.created_at|date:"M d, Y g:i A" }}</small>
              </li>
            {% empty %}
              <li class="list-group-item">No notes.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="mt-4 d-flex justify-content-between">
    <a href="{% url 'workorder_edit' job.id %}" class="btn btn-outline-primary">Edit Work Order</a>
    <a href="{% url 'workorder_list' %}" class="btn btn-secondary">Back to Work Orders</a>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<!-- Optional JS for further enhancements (e.g., date pickers or select2 if needed later) -->
{% endblock %}
