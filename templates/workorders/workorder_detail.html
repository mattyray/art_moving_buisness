{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block title %}Work Order Detail{% endblock %}
{% block content %}
<div class="container">
  <!-- Work Order Information Card -->
  <div class="card shadow-sm mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2>Work Order #{{ job.id }} Details</h2>
      <!-- Edit Button -->
      <a href="{% url 'workorder_edit' job.id %}" class="btn btn-warning">Edit Work Order</a>
    </div>
    <div class="card-body">
      <h4>Work Order Information</h4>
      <p><strong>ID:</strong> {{ job.id }}</p>
      <p><strong>Description:</strong> {{ job.job_description }}</p>
      <p><strong>Status:</strong> {{ job.get_status_display }}</p>
      <p><strong>Pickup Address:</strong> {{ job.pickup_address }}</p>
      <p><strong>Dropoff Address:</strong> {{ job.dropoff_address }}</p>
      <p><strong>Estimated Cost:</strong> ${{ job.estimated_cost }}</p>
      <p><strong>Scheduled Date:</strong> {{ job.scheduled_date|default:"Not Scheduled" }}</p>
      <p><strong>Completed At:</strong> {{ job.completed_at|default:"Not Completed" }}</p>
      <p><strong>Created At:</strong> {{ job.created_at|date:"Y-m-d H:i" }}</p>
      <p><strong>Last Edited:</strong> {{ job.updated_at|date:"Y-m-d H:i" }}</p>
    </div>
  </div>
  
  <!-- Client Information Card -->
  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <h3>Client Information</h3>
    </div>
    <div class="card-body">
      <p><strong>Name:</strong> {{ job.client.name }}</p>
      <p><strong>Email:</strong> {{ job.client.email }}</p>
      <p><strong>Phone:</strong> {{ job.client.phone }}</p>
      <p><strong>Address:</strong> {{ job.client.address }}</p>
    </div>
  </div>
  
  <!-- Attachments Card -->
  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <h3>Attachments</h3>
    </div>
    <div class="card-body">
      <ul class="list-group">
        {% for attachment in attachments %}
          <li class="list-group-item">
            <a href="{{ attachment.file.url }}">{{ attachment.file.name }}</a>
            <small class="text-muted">(Uploaded: {{ attachment.uploaded_at|date:"Y-m-d H:i" }})</small>
          </li>
        {% empty %}
          <li class="list-group-item">No attachments.</li>
        {% endfor %}
      </ul>
      <form method="post" enctype="multipart/form-data" class="mt-3">
        {% csrf_token %}
        {{ attachment_form|crispy }}
        <button type="submit" name="attachment_submit" class="btn btn-primary">Add Attachment</button>
      </form>
    </div>
  </div>
  
  <!-- Notes Card -->
  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <h3>Notes</h3>
    </div>
    <div class="card-body">
      <ul class="list-group">
        {% for note in notes %}
          <li class="list-group-item">
            {{ note.note }}
            <small class="text-muted">({{ note.created_at|date:"Y-m-d H:i" }})</small>
          </li>
        {% empty %}
          <li class="list-group-item">No notes.</li>
        {% endfor %}
      </ul>
      <form method="post" class="mt-3">
        {% csrf_token %}
        {{ note_form|crispy }}
        <button type="submit" name="note_submit" class="btn btn-primary">Add Note</button>
      </form>
    </div>
  </div>
  
  <a href="{% url 'workorder_list' %}" class="btn btn-secondary mt-3">Back to Work Orders</a>
</div>
{% endblock %}
