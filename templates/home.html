<!-- templates/home.html -->
{% extends "base.html" %}
{% block title %}Dashboard â€“ Art Moving Business{% endblock %}
{% block content %}
  <!-- Welcome Hero -->
  <div class="text-center mb-4">
    <h2 class="fw-bold">Welcome back, {{ user.username }} ðŸ‘‹</h2>
    <p class="text-muted">Hereâ€™s whatâ€™s happening today in your business.</p>
  </div>

  <!-- Quick Action Buttons -->
  <div class="row g-3 justify-content-center">
    <div class="col-lg-3 col-md-4 col-sm-6">
      <a href="{% url 'workorder_list' %}" class="btn btn-primary w-100 py-4 shadow-sm d-flex flex-column align-items-center">
        <i class="bi bi-card-checklist fs-1 mb-2"></i>
        <span>Work Orders</span>
      </a>
    </div>
    <div class="col-lg-3 col-md-4 col-sm-6">
      <a href="{% url 'client_list' %}" class="btn btn-warning w-100 py-4 shadow-sm d-flex flex-column align-items-center">
        <i class="bi bi-people-fill fs-1 mb-2"></i>
        <span>Clients</span>
      </a>
    </div>
    <div class="col-lg-3 col-md-4 col-sm-6">
      <a href="{% url 'invoice_list' %}" class="btn btn-danger w-100 py-4 shadow-sm d-flex flex-column align-items-center">
        <i class="bi bi-receipt fs-1 mb-2"></i>
        <span>Invoicing</span>
      </a>
    </div>
  </div>

  <!-- Calendar & Legend -->
  <div class="card mt-5 shadow-sm">
    <div class="card-header">
      <h5 class="mb-0">Calendar</h5>
    </div>
    <div class="card-body">
      <!-- Legend -->
      <div class="mb-3">
        <span class="badge bg-success me-2">Paid Invoice</span>
        <span class="badge bg-danger me-2">Unpaid Invoice</span>
        <span class="badge bg-secondary me-2">Work Order Events</span>
        <small class="d-block text-muted mt-1">
          Work order events are colorâ€‘coded uniquely per job.
        </small>
      </div>
      <!-- FullCalendar -->
      <div id="calendar"></div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  var calendarEl = document.getElementById("calendar");
  if (!calendarEl) return console.error("Calendar element not found!");

  var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridMonth",
    height: 'auto',
    events: async function(fetchInfo, success, fail) {
      try {
        let [wo, inv] = await Promise.all([
          fetch("/workorders/calendar-data/workorders/").then(r=>r.json()),
          fetch("/invoices/calendar-data/invoices/").then(r=>r.json())
        ]);
        success([...wo, ...inv]);
      } catch (e) {
        console.error("Calendar fetch error:", e);
        fail(e);
      }
    },
    eventClick: info => {
      if (info.event.url) {
        window.location.href = info.event.url;
        info.jsEvent.preventDefault();
      }
    }
  });
  calendar.render();
});
</script>
{% endblock %}
